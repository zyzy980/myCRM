<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link id="CustomTheme" type="text/css" rel="stylesheet" href="../../Resource/css/index/customLightBlue.css" />
<link id="EasyuiTheme" type="text/css" rel="stylesheet" href="../../Resource/js/easyUI/themes/easyuiLightBlue.css" />
<link id="JqgridTheme" type="text/css" rel="stylesheet" href="../../Resource/js/jqueryUI/theme/jqgridLightBlue/jquery-ui-1.10.4.custom.css" />
<link type="text/css" rel="stylesheet" href="../../Resource/js/easyUI/themes/icon.css" />
<link type="text/css" rel="stylesheet" href="../../Resource/js/jqueryUI/theme/ui.jqgrid.css" />
<title>统计规则明细</title>
	<style type="text/css">
		.redstar{color:red;}
	</style>
</head>
<body>
<div id="toolbar" class="easyui-panel" style="padding: 4px; border-width:0; border-bottom-width:1px;">
	#{PAGE_TOOLBAR_BUTTONROLE}
</div>
<form id="addForm" class="easyui-form" method="post" data-options="novalidate:true">
	<input type="hidden" name="sn" id="sn" value="" />
	<table class="editTable">
		<tr>
			<td class="editTitle">运输方式</td>
			<td class="editControl">
				<input type="text" name="trans_mode" id="trans_mode" class="easyui-textbox" data-options="required: true" /><span class="redstar">&nbsp;*</span>
			</td>

			<td class="editTitle">状态</td>
			<td class="editControl">
				<input type="text" name="state" id="state" class="easyui-textbox"  data-options="disabled:true" />
			</td>
		</tr>
		<tr>
			<td class="editTitle">起运地</td>
			<td class="editControl">
				<input type="text" name="begin_city" id="begin_city" class="easyui-combobox" data-options="required: true" /><span class="redstar">&nbsp;*</span>
			</td>
			<td class="editTitle">目的地</td>
			<td class="editControl">
				<input type="text" name="end_city" id="end_city" class="easyui-combobox" data-options="required: true" /><span class="redstar">&nbsp;*</span>
			</td>
		</tr>
		<tr>
			<td class="editTitle">有效期起</td>
			<td class="editControl">
				<input type="text" name="begin_date"  data-options="required:true"  id="begin_date" class="easyui-datebox" style="width: 100px"/>
			</td>
			<td class="editTitle">有效期止</td>
			<td class="editControl">
				<input type="text" name="end_date" data-options="required:true" id="end_date" class="easyui-datebox" style="width: 100px"/>
			</td>
		</tr>
		<tr>
			<td class="editTitle">对上第一段里程</td>
			<td class="editControl">
				<input type="text" name="up_first_mileage" id="up_first_mileage" class="easyui-numberbox" data-options="min:0,precision:0" />
			</td>
			<td class="editTitle">对上第一段单价</td>
			<td class="editControl">
				<input type="text" name="up_first_price" id="up_first_price" class="easyui-numberbox" data-options="min:0,precision:2" />
			</td>
		</tr>
		<tr>
			<td class="editTitle">对上第二段里程</td>
			<td class="editControl">
				<input type="text" name="up_two_mileage" id="up_two_mileage" class="easyui-numberbox" data-options="min:0,precision:0" />
			</td>
			<td class="editTitle">对上第二段单价</td>
			<td class="editControl">
				<input type="text" name="up_two_price" id="up_two_price" class="easyui-numberbox" data-options="min:0,precision:2" />
			</td>
		</tr>
		<tr>
			<td class="editTitle">对上第三段里程</td>
			<td class="editControl">
				<input type="text" name="up_three_mileage" id="up_three_mileage" class="easyui-numberbox" data-options="min:0,precision:0" />
			</td>
			<td class="editTitle">对上第三段单价</td>
			<td class="editControl">
				<input type="text" name="up_three_price" id="up_three_price" class="easyui-numberbox" data-options="min:0,precision:2" />
			</td>
		</tr>
		<tr>
			<td class="editTitle">对上保费</td>
			<td class="editControl">
				<input type="text" name="up_premium" id="up_premium" class="easyui-numberbox" data-options="min:0,precision:2" />
			</td>
			<td class="editTitle">对上总价</td>
			<td class="editControl">
				<input type="text" name="up_total" id="up_total" class="easyui-numberbox" data-options="min:0,precision:2" />
			</td>
		</tr>
		<tr>
			<td class="editTitle">对下第一段里程</td>
			<td class="editControl">
				<input type="text" name="down_first_mileage" id="down_first_mileage" class="easyui-numberbox" data-options="min:0,precision:0" />
			</td>
			<td class="editTitle">对下第一段单价</td>
			<td class="editControl">
				<input type="text" name="down_first_price" id="down_first_price" class="easyui-numberbox" data-options="min:0,precision:2" />
			</td>
		</tr>
		<tr>
			<td class="editTitle">对下第二段里程</td>
			<td class="editControl">
				<input type="text" name="down_two_mileage" id="down_two_mileage" class="easyui-numberbox" data-options="min:0,precision:0" />
			</td>
			<td class="editTitle">对下第二段单价</td>
			<td class="editControl">
				<input type="text" name="down_two_price" id="down_two_price" class="easyui-numberbox" data-options="min:0,precision:2" />
			</td>
		</tr>
		<tr>
			<td class="editTitle">对下第三段里程</td>
			<td class="editControl">
				<input type="text" name="down_three_mileage" id="down_three_mileage" class="easyui-numberbox" data-options="min:0,precision:0" />
			</td>
			<td class="editTitle">对下第三段单价</td>
			<td class="editControl">
				<input type="text" name="down_three_price" id="down_three_price" class="easyui-numberbox" data-options="min:0,precision:2" />
			</td>
		</tr>
		<tr>
			<td class="editTitle">对下过海费</td>
			<td class="editControl">
				<input type="text" name="down_cross_sea_amount" id="down_cross_sea_amount" class="easyui-numberbox" data-options="min:0,precision:2" />
			</td>
			<td class="editTitle">对下保费</td>
			<td class="editControl">
				<input type="text" name="down_premium" id="down_premium" class="easyui-numberbox" data-options="min:0,precision:2" />
			</td>
		</tr>
		<tr>
			<td class="editTitle">对下总价</td>
			<td class="editControl">
				<input type="text" name="down_total" id="down_total" class="easyui-numberbox" data-options="min:0,precision:2" />
			</td>
			<td class="editTitle">对上过海费</td>
			<td class="editControl">
				<input type="text" name="up_cross_sea_amount" id="up_cross_sea_amount" class="easyui-numberbox" data-options="min:0,precision:2" />
			</td>
		</tr>
		<tr>
			<td class="editTitle">创建人员</td>
			<td class="editControl">
				<input type="text" name="create_by" id="create_by" class="easyui-textbox"  data-options="disabled:true"  />
			</td>
			<td class="editTitle">创建时间</td>
			<td class="editControl">
				<input type="text" name="create_date" id="create_date" class="easyui-textbox"  data-options="disabled:true" />
			</td>
		</tr>
	</table>
</form>

<script type="text/javascript" src="../../Resource/js/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="../../Resource/js/jquery.i18n.properties.js"></script>
<script type="text/javascript" src="../../Resource/js/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/jquery.easyuiExtend.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="../../Resource/js/base/commonControl.js"></script>
<script type="text/javascript" src="../../Resource/js/base/globalVariable.js"></script>
<script type="text/javascript" src="../../Resource/js/base/commonBusiness.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/i18n/grid.locale-cn.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/jquery.jqGrid.min.js"></script>
<script type="text/javascript" src="../../Resource/js/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/plugins/grid.setcolumns.js"></script>
<script type="text/javascript" src="../../Resource/js/regex/regex.js"></script>
<script language="javascript" type="text/javascript">
    var afterSave = 'close';
    var pid="";
    var originalFormData=null;
    $(function() {
        var parms = getUrlParms();
		pid = parms['pid'];
        var sn = parms['sn'];
		$("#sn").val(sn);
        initData();
    });

    $(window).load(function() { hideLoading(); });

    var initData = function() {
		getDictionaryData([
			{
				//运输方式 - 数据字典
				dicTypeCode : Global_DicType.TRANS_MODE,
				ADD_ALL: false,
				callback : function(callbackData) {
					$("#trans_mode").combobox({
						valueField: 'dicvalue',
						textField: 'dictext',
						panelWidth:170,
						panelHeight: 200,
						editable: true
					});
					$("#trans_mode").combobox("loadData", callbackData);
				}
			},
			{
				//起/目运地 - 数据字典
				dicTypeCode : Global_DicType.CITY_ARCHIVE,
				ADD_ALL: false,
				callback : function(callbackData) {
					$("#begin_city,#end_city").combobox({
						valueField: 'dicvalue',
						textField: 'dictext',
						panelHeight: 200,
						editable: true
					});
					$("#begin_city,#end_city").combobox("loadData", callbackData);
				}
			}
		]);



        if ($("#sn").val()!= '') {
             loadDetail();// 加载基本信息
            $("#trans_mode,#begin_city,#end_city").combobox({disabled:true});
        } else {
			$("#state").textbox('setValue', "正常");
            originalFormData = $('#addForm').serialize();
        }
    };

    // 关闭
    var close = function() { closeDialog(pid); };

	// 验证
    var validate = function() {
		var validated = $("#addForm").form('enableValidation').form('validate');
		if (!validated) {
			errorNotification({
				SimpleMessage: "保存操作中部分数据验证不通过"
			});
			return false;
		}

        return true;
    };

    // 保存
    var save = function() {
        if (!validate()) {
            return;
        }
		$.messager.confirm('提示', '确定保存吗?', function (r) {
			if (r) {
				showLoading();
				var data= FormUtils.toJSONObject($("#addForm"));
				$.ajax({
					url : "../../base/tr_statistical_rules/SaveDetail?t="+ Math.random(),
					contentType : 'application/json;charset=utf-8',
					dataType:"json",
					type : "POST",
					data : JSON.stringify(data),
					success : function(dataObj) {
						hideLoading();
						if (isServerResultDataPass(dataObj)) {
							correctNotification({SimpleMessage : "数据保存成功。"});
							getCurrentTab().searchData();
						} else {
							FailResultDataToTip(dataObj);
						}
					}
				});
			}
		});
	};

	// 保存后的操作
    var afterSaveOperate = function() {
        switch (afterSave) {
            case 'close':
                refreshCallerData();
                close();
                break;
            case 'clear':
                $('form').form('clear');
                refreshCallerData();
                break;
            case 'copy':
                refreshCallerData();
                break;
            default:
            	break;
        }
    };
	// 刷新页面数
    var refreshCallerData = function() {
        if (callerType == Global_Constant.Global_Constant_CallerType_Dialog) {
            //此callerId此时为dialog的id
            getDialog(callerId).refreshCallerData_List(callbackFlag);
        } else {
            //此callerId此时为frame的id
            getCurrentTab(callerId).refreshCallerData_List(callbackFlag);
        }
    };

    // 加载详细信息
	function loadDetail() {
		showLoading();
		var serverUrl = "../../base/tr_statistical_rules/getDetail?t="+ Math.random();
		$.ajax({
			type : "POST",
			url : serverUrl,
			data : JSON.stringify({"sn":$("#sn").val()}),
			contentType : 'application/json;charset=utf-8', // 设置请求头信息
			success : function(dataObj) {
				if (isServerResultDataPass(dataObj)) {
					$("#sn").val(dataObj.resultDataFull.sn);
					$("#trans_mode").textbox('setValue', dataObj.resultDataFull.trans_mode);
					$("#begin_city").combobox('setValue', dataObj.resultDataFull.begin_city);
					$("#end_city").combobox('setValue', dataObj.resultDataFull.end_city);

					$("#up_first_mileage").numberbox('setValue', dataObj.resultDataFull.up_first_mileage);
					$("#up_first_price").numberbox('setValue', dataObj.resultDataFull.up_first_price);
					$("#up_two_mileage").numberbox('setValue', dataObj.resultDataFull.up_two_mileage);
					$("#up_two_price").numberbox('setValue', dataObj.resultDataFull.up_two_price);
					$("#up_three_mileage").numberbox('setValue', dataObj.resultDataFull.up_three_mileage);
					$("#up_three_price").numberbox("setValue", dataObj.resultDataFull.up_three_price);
					$("#up_premium").numberbox('setValue', dataObj.resultDataFull.up_premium);
					$("#up_total").numberbox('setValue', dataObj.resultDataFull.up_total);
					$("#down_first_mileage").numberbox('setValue', dataObj.resultDataFull.down_first_mileage);
					$("#down_first_price").numberbox('setValue', dataObj.resultDataFull.down_first_price);
                    $("#begin_date").textbox("setValue", dataObj.resultDataFull.begin_date);
                    $("#end_date").textbox("setValue", dataObj.resultDataFull.end_date);
					$("#down_two_mileage").numberbox('setValue', dataObj.resultDataFull.down_two_mileage);
					$("#down_two_price").numberbox('setValue', dataObj.resultDataFull.down_two_price);
					$("#down_three_mileage").numberbox('setValue', dataObj.resultDataFull.down_three_mileage);
					$("#down_three_price").numberbox('setValue', dataObj.resultDataFull.down_three_price);
					$("#down_cross_sea_amount").numberbox('setValue', dataObj.resultDataFull.down_cross_sea_amount);
					$("#down_premium").numberbox('setValue', dataObj.resultDataFull.down_premium);
					$("#down_total").numberbox('setValue', dataObj.resultDataFull.down_total);
					$("#up_cross_sea_amount").numberbox('setValue', dataObj.resultDataFull.up_cross_sea_amount);

					$("#create_by").textbox('setValue', dataObj.resultDataFull.create_by);
					$("#create_date").textbox('setValue', dataObj.resultDataFull.create_date);

					$("#state").textbox('setValue', dataObj.resultDataFull.state=="0"?"正常":"注销");

					 originalFormData = $('#addForm').serialize();
				} else {
					FailResultDataToTip(dataObj);
				}
				hideLoading();
			},
		});
	}



</script>
</body>
</html>
