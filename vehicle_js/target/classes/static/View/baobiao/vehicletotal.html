<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<link id="CustomTheme" type="text/css" rel="stylesheet" href="../../Resource/css/index/customLightBlue.css" />
	<link id="EasyuiTheme" type="text/css" rel="stylesheet" href="../../Resource/js/easyUI/themes/easyuiLightBlue.css" />
	<link id="JqgridTheme" type="text/css" rel="stylesheet" href="../../Resource/js/jqueryUI/theme/jqgridLightBlue/jquery-ui-1.10.4.custom.css" />
	<link type="text/css" rel="stylesheet" href="../../Resource/js/easyUI/themes/icon.css" />
	<link type="text/css" rel="stylesheet" href="../../Resource/js/jqueryUI/theme/ui.jqgrid.css" />
	<link type="text/css" rel="stylesheet" href="../../Resource/js/moment/css/daterangepicker.css" />
	<link type="text/css" rel="stylesheet" href="../../Resource/js/fileUpload/css/fileUpload.css" />
	<title>商品车统计</title>
</head>
<body>
<div id="toolbar" class="easyui-panel" style="padding:4px;border-width:0;border-bottom-width:1px;">
	#{PAGE_TOOLBAR_BUTTONROLE}
</div>
<div class="searchParamesPanel">
	<table id="searchParamesTable">
		<tr class="searchParamesTrShow">
			<td class="searchParamesTdTitle">起运时间:</td>
			<td class="searchParamesTdControl">
				<input type="text" name="begin_date_start" id="begin_date_start" class="easyui-datebox" style="width: 100px" />
			</td>
			<td class="searchParamesTdTitle">
				-
			</td>
			<td class="searchParamesTdControl">
				<input type="text" name="begin_date_end" id="begin_date_end" class="easyui-datebox" style="width: 100px" />
			</td>
			<td width="20px;"></td>
			<td class="searchParamesTdTitle">起运地</td>
			<td class="searchParamesTdControl">
				<input type="text" name="begin_city" id="begin_city" class="easyui-combobox" style="width: 100px" />
			</td>
			<td width="20px;"></td>
			<td class="searchParamesTdTitle">运输方式:</td>
			<td class="searchParamesTdControl">
				<input type="text" name="trans_mode" data-options="multiple:true" id="trans_mode" class="easyui-combobox" />
			</td>
			<td width="20px;"></td>
			<td class="searchParamesTdTitle">结算进度</td>
			<td class="searchParamesTdControl">
				<input type="text" id="js_state" class="easyui-combobox" data-options="multiple:true" style="width: 100px" />
			</td>
		</tr>
		<tr class="searchParamesTrShow">
			<td class="searchParamesTdTitle">收车时间:</td>
			<td class="searchParamesTdControl">
				<input type="text" name="end_date_start" id="end_date_start" class="easyui-datebox" style="width: 100px" />
			</td>
			<td class="searchParamesTdTitle">
				-
			</td>
			<td class="searchParamesTdControl">
				<input type="text" name="end_date_end" id="end_date_end" class="easyui-datebox" style="width: 100px" />
			</td>
			<td width="20px;"></td>
			<td class="searchParamesTdTitle">目的地</td>
			<td class="searchParamesTdControl">
				<input type="text" name="end_city" id="end_city" class="easyui-combobox" style="width: 100px" />
			</td>
			<td width="20px;"></td>
			<td class="searchParamesTdTitle">承运商:</td>
			<td class="searchParamesTdControl">
				<input type="text" name="carrier_no" id="carrier_no" data-options="multiple:true" class="easyui-combobox" />
			</td>
			<td width="20px;"></td>
			<td class="searchParamesTdTitle">数据来源</td>
			<td class="searchParamesTdControl">
				<input type="text" id="from_data" class="easyui-combobox"  style="width: 100px" />
			</td>
			<td class="searchParamesTdControl">
				<input type="text" id="common_sheet_title" class="easyui-textbox" style="width: 240px" />
			</td>
		</tr>
	</table>
</div>
<div id="gridControl">
	<table id="gridTable"></table>
	<div id="gridPager"></div>
</div>
<div id="fileUpload" style="position: absolute; left: 50%; top: 50%;width: 600px; height: 400px; margin-left: -300px; margin-top: -200px; display: none;"></div>
<script type="text/javascript" src="../../Resource/js/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="../../Resource/js/jquery.i18n.properties.js"></script>
<script type="text/javascript" src="../../Resource/js/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="../../Resource/js/base/commonControl.js"></script>
<script type="text/javascript" src="../../Resource/js/base/globalVariable.js"></script>
<script type="text/javascript" src="../../Resource/js/base/commonBusiness.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/i18n/grid.locale-cn.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/jquery.jqGrid.min.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/plugins/grid.setcolumns.js"></script>
<script type="text/javascript" src="../../Resource/js/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="../../Resource/js/moment/js/moment.min.js"></script>
<script type="text/javascript" src="../../Resource/js/moment/js/jquery.daterangepicker.js"></script>
<script type="text/javascript" src="../../Resource/js/fileUpload/js/upload.js"></script>
<script type="text/javascript" src="../../Resource/js/fileUpload/js/file.js"></script>
<script language="javascript" type="text/javascript">
	$(function() {
		var parms = getUrlParms();
		initScript();
		initData();
		initStyle();
	});

	$(window).load(function() {
		hideLoading();
	});

	var initStyle = function() {
        $("#common_sheet_title").textbox({
            prompt: "运单号/VIN"
        });
		enterTriggerEvent('searchParamesTable', 'searchData');
	};

	var initScript = function() {
		$(window).resize(function() {
			setGridHeightWidth();
			setToolbarHeightWidth();
		});
	};

	// 加载数据
	var initData = function() {
        var date = new Date();
        var days = new Date(date.getTime() - 86400000*7);
        searchBTime=days.getFullYear()+"-"+(days.getMonth())+"-26";
        searchETime=date.getFullYear()+"-"+(date.getMonth()+1)+"-25";
/*        searchBTime_JH =days.getFullYear()+"-"+(days.getMonth()+1)+"-"+days.getDate()+' '+days.getHours() + ':' + days.getMinutes();
        searchETime_JH=date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate()+' '+date.getHours() + ':' + date.getMinutes();*/
        $("#end_date_start").textbox('setValue', searchBTime);
        $("#end_date_end").textbox('setValue', searchETime);

        var from_dataList=[];
		from_dataList.push({dicvalue:"",dictext:"所有"});
		from_dataList.push({dicvalue:"业务",dictext:"业务"});
		from_dataList.push({dicvalue:"导入",dictext:"导入"});

		$("#from_data").combobox({
			valueField: 'dicvalue',
			textField: 'dictext',
            panelHeight: 80,
			editable: false,
            onSelect:function(){
                searchData();
            }

		});
		$("#from_data").combobox("loadData", from_dataList);

		getDictionaryData([{
			//初始化结算状态数据字典
			dicTypeCode: Global_DicType.JS_STATE,
			ADD_ALL: true,
			callback: function (callbackData) {
				window.JS_STATEMap = {};
				for (var i = 0; i < callbackData.length; i++) {
					JS_STATEMap[callbackData[i].dicvalue] = callbackData[i].dictext;
				}
				$("#js_state").combobox({
					valueField: 'dicvalue',
					textField: 'dictext',
					panelHeight: 200,
					editable: true,
                    onLoadSuccess: defaultSelect,
                    labelSeparator:',',
                    displaySeparator:',',
                    valueSeparator:',',
                    onSelect : comboChange,
                    onUnselect : comboChange,
                    onChange : function() {
                        var vals = $(this).combobox("getValues");
                        var datas = $(this).combobox("getData");
                        for (var i = 0; i < vals.length; i++) {
                            if (vals[i] == "") {
                                return;
                            }
                        }
                        for (var i = 0; i < vals.length; i++) {
                            if (isInArray(datas, vals[i])) {
                                /*  searchData(); */
                                break;
                            }
                        }
                    }
				});
				$("#js_state").combobox("loadData", callbackData);
			}
		}, {
            //初始化结算状态数据字典
            dicTypeCode: Global_DicType.JS_DOWN_STATE,
            callback: function (callbackData) {
                window.DOWN_JS_STATEMap = {};
                for (var i = 0; i < callbackData.length; i++) {
                    DOWN_JS_STATEMap[callbackData[i].dicvalue] = callbackData[i].dictext;
                }
            }
        },{
				//起运地 - 数据字典
				dicTypeCode: Global_DicType.CITY_ARCHIVE,
				ADD_ALL: true,
				callback: function (callbackData) {
					window.BEGIN_ADDRESSMap = {};
					window.END_ADDRESSMap = {};
					for (var i = 0; i < callbackData.length; i++) {
						BEGIN_ADDRESSMap[callbackData[i].dicvalue] = callbackData[i].dictext;
						END_ADDRESSMap[callbackData[i].dicvalue] = callbackData[i].dictext;
					}
					$("#begin_city,#end_city").combobox({
						valueField: 'dicvalue',
						textField: 'dictext',
						panelHeight: 200,
						editable: true,
                        onSelect:function(){
                            searchData();
                        }
					});
					$("#begin_city,#end_city").combobox("loadData", callbackData);
				}
			},{
            //加载运输方式字典
            dicTypeCode : Global_DicType.TRANS_MODE,
            ADD_ALL: true,
            callback : function(callbackData) {
                window.TransModeList = {};
                for(var i = 0; i < callbackData.length; i++){
                    TransModeList[callbackData[i].dicvalue] = callbackData[i].dictext;
                }
                $("#trans_mode").combobox({
                    valueField: 'dicvalue',
                    textField: 'dictext',
                    panelHeight: 200,
                    panelWidth: 250,
                    editable: true,
                    onLoadSuccess: defaultSelect,
                    labelSeparator:',',
                    displaySeparator:',',
                    valueSeparator:',',
                    onSelect : comboChange,
                    onUnselect : comboChange,
                    onChange : function() {
                        var vals = $(this).combobox("getValues");
                        var datas = $(this).combobox("getData");
                        for (var i = 0; i < vals.length; i++) {
                            if (vals[i] == "") {
                                return;
                            }
                        }
                        for (var i = 0; i < vals.length; i++) {
                            if (isInArray(datas, vals[i])) {
                                /*  searchData(); */
                                break;
                            }
                        }
                    }
                });
                $("#trans_mode").combobox("loadData", callbackData);
			}
        }]);
        getBaseData([{
            //初始化承运商档案
            dicTypeCode : Global_BaseDataKey.ZD_CARRIER,
            callback : function(callbackData) {
                $("#carrier_no").combobox({
                    valueField: 'code',
                    textField: 'name',
                    panelWidth: 250,
                    panelHeight: 150,
                    editable: true,
                    onLoadSuccess: defaultSelect,
                    labelSeparator:',',
                    displaySeparator:',',
                    valueSeparator:',',
                    onSelect : comboChange,
                    onUnselect : comboChange,
                    onChange : function() {
                        var vals = $(this).combobox("getValues");
                        var datas = $(this).combobox("getData");
                        for (var i = 0; i < vals.length; i++) {
                            if (vals[i] == "") {
                                return;
                            }
                        }
                        for (var i = 0; i < vals.length; i++) {
                            if (isInArray(datas, vals[i])) {
                                /*  searchData(); */
                                break;
                            }
                        }
                    }
                });
                callbackData.unshift({code: "", name: "所有"});
                $("#carrier_no").combobox("loadData", callbackData);
            }
        }]);
		loadList();// 加载数据列表
	};

	// 查询数据
	function searchData() {
		$('#gridTable').jqGrid('setGridParam', {
			url: getSearchGridUrl(),
			datatype: 'json',
			postData: { 'filters': '' },
			page: 1
		}).trigger('reloadGrid');
	};

	// 获取查询URL
	var getSearchGridUrl = function() {
		return '../../settlement/Js_Vin_AmountController/getListForGridBaobiao?t=' + Math.random() + '&customSearchFilters=' + encodeURI(getSearchFilters());
	};

	// 获取查询条件
	var getSearchFilters = function() {
        var end_date_end=$('#end_date_end').datebox('getValue');
        if(end_date_end!="")
            end_date_end=addDate(end_date_end,1);
        var begin_date_end=$('#begin_date_end').datebox('getValue');
        if(begin_date_end!="")
            begin_date_end=addDate(begin_date_end,1);
		var parmsArray = [
            [
                { name: 'vdr_no', value: $('#common_sheet_title').textbox('getValue'), op: 'cn'},
                { name: 'vin', value: $('#common_sheet_title').textbox('getValue'), op: 'cn'}
            ],
            getMultipleComboVal($('#trans_mode'),'trans_mode'),
            getMultipleComboVal($('#carrier_no'),'carrier_no'),
            getMultipleComboVal($('#js_state'),'js_schedule'),
            { name: 'receipt_date', value: $('#end_date_start').datebox('getValue'), op: 'ge'},
            { name: 'receipt_date', value: end_date_end, op: 'le'},
            { name: 'begin_date', value: $('#begin_date_start').datebox('getValue'), op: 'ge'},
            { name: 'begin_date', value: begin_date_end, op: 'le'},
			{ name: 'begin_city', value: $('#begin_city').combobox('getValue'), op: 'eq'},
			{ name: 'end_city', value: $('#end_city').combobox('getValue'), op: 'eq'},
			{ name: 'from_data', value: $('#from_data').combobox('getValue'), op: 'eq' }

		];
		return formatSearchParames(parmsArray);
	};

	// 加载数据列表
	var loadList = function() {
		$('#gridTable').jqGrid({
			url: getSearchGridUrl(),
			datatype: 'json',
			width: 'none',
			colNames: [
				"序号","业务完成月","统计月","发运日期","收车日期","属性","项目","类别","询价号","合同号","客户合同号","分包商","AIC","运单号","VIN码","运输方式","起点","终点","省份","经销商名称","合同里程","车型","对上单价","运费收入小计","保费收入","其他收入","统计收入","对下价格","其他费用","保费支出","统计成本","重损备注","收单日期","回单日期","结算异常备注","结算号","开票日期","发票号码","实际收入含税","实际收入不含税","实际成本","结算进度","商务审核人","实际成本(含税)","对下开票月份","下家发票号码","对下结算进度","付款计划提报月","车牌号","备注","数据来源","id"
			],
			colModel: [
				{/*序号*/ name: 'num', index: 'num', align: 'left', width: 60, key:true,type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*业务完成月*/ name: 'bus_completion_month', index: 'bus_completion_month', align: 'center', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*统计月*/ name: 'statistical_month', index: 'statistical_month', align: 'center', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*发运日期*/ name: 'begin_date', index: 'begin_date', align: 'center', width: 90, type: 'string', search: true, searchoptions: { sopt: ['le'], dataEvents: [ { type: 'click', data: {}, fn: function() { WdatePicker(); } } ] }
					,formatter:function(value,grid,rows){
						var begin_date=rows.begin_date;
						if(begin_date!=null && begin_date.indexOf(" ")!=-1)
						{
							begin_date=begin_date.split(" ")[0];
						}else if(begin_date==null)
						{
							begin_date="";
						}
						return begin_date;
					}
				},
				{/*收车日期*/ name: 'receipt_date', index: 'receipt_date', align: 'center', width: 90, type: 'string', search: true, searchoptions: { sopt: ['le'], dataEvents: [ { type: 'click', data: {}, fn: function() { WdatePicker(); } } ] }
					,formatter:function(value,grid,rows){
						var begin_date=rows.receipt_date;
						if(begin_date!=null && begin_date.indexOf(" ")!=-1)
						{
							begin_date=begin_date.split(" ")[0];
						}else if(begin_date==null)
						{
							begin_date="";
						}
						return begin_date;
					}
				},
				{/*属性*/ name: 'attribute', index: 'attribute', align: 'center', width: 60, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*项目*/ name: 'project', index: 'project', align: 'center', width: 60, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*类别*/ name: 'type', index: 'type', align: 'center', width: 60, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*询价号*/ name: 'xunjia_no', index: 'xunjia_no', align: 'left', width: 90, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*合同号*/ name: 'contract_no', index: 'contract_no', align: 'left', width: 100, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*客户合同号*/ name: 'cus_contract_no', index: 'cus_contract_no', align: 'left', width: 100, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*分包商*/ name: 'carrier_name', index: 'carrier_name', align: 'left', width: 130, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*AIC*/ name: 'aic', index: 'aic', align: 'left', width: 110, key:true,type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*运单号*/ name: 'vdr_no', index: 'vdr_no', align: 'left', width: 110, key:true,type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*VIN码*/ name: 'vin', index: 'vin', align: 'left', width: 135, key:true,type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*运输方式*/ name: 'trans_mode', index: 'trans_mode', align: 'left', width: 100, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*起点*/ name: 'begin_city', index: 'begin_city', align: 'center', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*终点*/ name: 'end_city', index: 'end_city', align: 'center', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*省份*/ name: 'end_province', index: 'end_province', align: 'center', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*经销商名称*/ name: 'dealer_name', index: 'dealer_name', align: 'left', width: 150, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*合同里程*/ name: 'mil', index: 'mil', align: 'center', width: 70, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*车型*/ name: 'car_type', index: 'car_type', align: 'center', width: 70, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*对上单价*/ name: 'price', index: 'price', align: 'right', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] }
                    ,formatter: function (value, grid, rows) {
                        return keepThreePointData(rows.price);
                    }},
				{/*运费收入小计*/ name: 'not_tax_freight', index: 'not_tax_freight', align: 'right', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] }
                    ,formatter: function (value, grid, rows) {
                        return keepTwoPointData(rows.not_tax_freight);
                    }},
				{/*保费收入*/ name: 'not_tax_premium', index: 'not_tax_premium', align: 'right', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*其他收入*/ name: 'not_tax_other_amount', index: 'not_tax_other_amount', align: 'right', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] }
                    ,formatter: function (value, grid, rows) {
                        return keepTwoPointData(rows.not_tax_other_amount);
                    }},
				{/*统计收入*/ name: 'not_tax_amount', index: 'not_tax_amount', align: 'right', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] }
                    ,formatter: function (value, grid, rows) {
                        return keepTwoPointData(rows.not_tax_amount);
                    }},
				{/*对下价格*/ name: 'not_tax_price', index: 'not_tax_price', align: 'right', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] }
                    ,formatter: function (value, grid, rows) {
                        return keepTwoPointData(rows.not_tax_price);
                    }},
				{/*其他费用*/ name: 'not_tax_other_amount_down', index: 'not_tax_other_amount_down', align: 'right', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] }
                    ,formatter: function (value, grid, rows) {
                        return keepTwoPointData(rows.not_tax_other_amount_down);
                    }},
				{/*保费支出*/ name: 'down_ntax_premium', index: 'down_ntax_premium', align: 'right', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*统计成本*/ name: 'down_ntax_amount', index: 'down_ntax_amount', align: 'right', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] }
                    ,formatter: function (value, grid, rows) {
                        return keepTwoPointData(rows.down_ntax_amount);
                    }},
				{/*重损备注*/ name: 'zs_remark', index: 'zs_remark', align: 'left', width: 110, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*收单日期*/ name: 'receipt_sheet_date', index: 'receipt_sheet_date', align: 'left', width: 90, type: 'string', search: true, searchoptions: { sopt: ['le'], dataEvents: [ { type: 'click', data: {}, fn: function() { WdatePicker(); } } ] }
					,formatter:function(value,grid,rows){
						var begin_date=rows.receipt_sheet_date;
						if(begin_date!=null && begin_date.indexOf(" ")!=-1)
						{
							begin_date=begin_date.split(" ")[0];
						}else if(begin_date==null)
						{
							begin_date="";
						}
						return begin_date;
					}
				},
				{/*回单日期*/ name: 'return_date', index: 'return_date', align: 'left', width: 90, type: 'string', search: true, searchoptions: { sopt: ['le'], dataEvents: [ { type: 'click', data: {}, fn: function() { WdatePicker(); } } ] }
					,formatter:function(value,grid,rows){
						var begin_date=rows.return_date;
						if(begin_date!=null && begin_date.indexOf(" ")!=-1)
						{
							begin_date=begin_date.split(" ")[0];
						}else if(begin_date==null)
						{
							begin_date="";
						}
						return begin_date;
					}
				},
				{/*结算异常备注*/ name: 'js_unusual_remark', index: 'js_unusual_remark', align: 'left', width: 110, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*结算号*/ name: 'js_no', index: 'js_no', align: 'left', width: 100, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*开票日期*/ name: 'invoice_date', index: 'invoice_date', align: 'left', width: 90, type: 'string', search: true, searchoptions: { sopt: ['le'], dataEvents: [ { type: 'click', data: {}, fn: function() { WdatePicker(); } } ] }
					,formatter:function(value,grid,rows){
						var begin_date=rows.invoice_date;
						if(begin_date!=null && begin_date.indexOf(" ")!=-1)
						{
							begin_date=begin_date.split(" ")[0];
						}else if(begin_date==null)
						{
							begin_date="";
						}
						return begin_date;
					}
				},
				{/*发票号码*/ name: 'invoice_no', index: 'invoice_no', align: 'left', width: 110, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*实际收入含税*/ name: 'real_tax_amount', index: 'real_tax_amount', align: 'right', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*实际收入不含税*/ name: 'real_ntax_amount', index: 'real_ntax_amount', align: 'right', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*实际成本*/ name: 'real_cost', index: 'real_cost', align: 'right', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{/*结算进度*/ name: 'js_schedule', index: 'js_schedule', align: 'left', width: 80, type: 'string', search: true, searchoptions: { sopt: [ 'eq'] }
					,formatter:function(value,grid,rows) {
                        return (rows.js_schedule==null || rows.js_schedule=="")?"":window.JS_STATEMap[rows.js_schedule];
                    }
				},
				{/*商务审核人*/ name: 'business_auditor', index: 'business_auditor', align: 'left', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },

				{ name: 'tax_real_cost', index: 'tax_real_cost', align: 'right', width: 90, type: 'string', search: true,hidden:true, searchoptions: { sopt: ['eq'] } },
				{ name: 'down_invoice_month', index: 'down_invoice_month', align: 'left', width: 130, type: 'string', search: true, hidden:true, searchoptions: { sopt: ['eq'] } },
				{ name: 'down_invoice_no', index: 'down_invoice_no', align: 'center', width: 100, type: 'string', search: true, hidden:true, searchoptions: { sopt: ['eq'] }  },
				{ name: 'down_js_state', index: 'down_js_state', align: 'center', width: 100, type: 'string', search: true,hidden:true, searchoptions: { sopt: ['eq'] }
                    ,formatter:function(value,grid,rows) {
                        return (rows.down_js_state==null || rows.down_js_state=="")?"":window.DOWN_JS_STATEMap[rows.down_js_state];
                    }},
				{ name: 'down_pay_plan_date', index: 'down_pay_plan_date', align: 'left', width: 150, type: 'string', search: true,hidden:true, searchoptions: { sopt: ['le'], dataEvents: [ { type: 'click', data: {}, fn: function() { WdatePicker(); } } ] } },
				{ name: 'car_no', index: 'car_no', align: 'center', width: 70, type: 'string', search: true,hidden:true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{ name: 'remark', index: 'remark', align: 'left', width: 90, type: 'string', search: true, hidden:true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } },
				{ name: 'from_data', index: 'from_data', align: 'center', width: 60,key:true, type: 'string', search: true, searchoptions: { sopt: ['eq'] } },
				{ name: 'id', index: 'id', align: 'left', width: 30, key:true,type: 'string',  search: true, hidden:true, searchoptions: { sopt: ['cn', 'eq', 'ne'] } }
			],
			shrinkToFit: false,
			altRows: true,
			altclass: 'gridSpacingClass',
			forceFit: true,
			cellLayout: 0,
			scroll: false,
			autowidth: true,
			sortname: 'begin_date',
			sortorder: 'asc',
			loadonce: false,
			mtype: 'POST',
			viewrecords: true,
			rownumbers: true,
			multiselect: true,
			rowNum: 15,
			height: '100%',
			rowList: [15, 20, 30, 50],
			pager: '#gridPager',
			jsonReader: {
				root: 'rows',
				total: 'total',
				page: 'page',
				records: 'records',
				repeatitems: false
			},
			gridComplete: function() {
				$('.cbox').shiftSelect();
			},
			loadComplete: function(xhr) {
				FailResultDataToTip(xhr);
			}
		});
		$('#gridTable').jqGrid('navGrid', '#gridPager',{
			add : false,
			edit : false,
			del : false,
			refresh : true
		}, {}, {}, {}, {
			multipleSearch : true,
			closeOnEscape : true,
			closeAfterSearch : true
		});
		$('#gridTable').jqGrid('navButtonAdd', '#gridPager', {
			caption : '设置列',
			title : 'Set Columns',
			onClickButton : toggleGridColumns
		});
		$('#gridTable').jqGrid('navButtonAdd', '#gridPager', {
			caption : '快速搜索',
			title : 'Quick Search',
			onClickButton : toggleGridSearchToolbar
		});
		$('#gridTable').jqGrid('navButtonAdd', '#gridPager', {
			caption: '导出数据',
			title: 'Export Datas',
			buttonicon: 'ui-icon-disk',
			onClickButton: function () {
				exportData();
			}
		});
		setGridHeightWidth();
	};


	function del()
	{
		var selectRowItems=$("#gridTable").jqGrid("getGridParam","selarrrow");
		if(selectRowItems.length==0)
		{
			errorNotification({
				SimpleMessage:"请至少选择一行数据进行操作。"
			});
			return;
		}
		var requestParams=[];
		var error="";
		for(var i=0,ilen=selectRowItems.length;i<ilen;i++)
		{
			var rowData=$("#gridTable").jqGrid("getRowData",selectRowItems[i]);
			if(rowData.from_data=="导入") {
				requestParams.push(rowData.id);
			}else {
				error+=rowData.num+",";
			}
		}
		if(error!="")
		{
			errorNotification({
				SimpleMessage:"选中“数据来源”不是导入，不能删除，只能删除导入数据；序号是："+error
			});
			return;
		}

		$.messager.confirm("提示","确定删除选中的导入数据吗？",function(r){
			if(r){
				showLoading();
				$.ajax({
					url:"../../settlement/Js_Vin_AmountController/delBaobiao?t=" + Math.random(),
					type:"post",
					contentType: "application/json",
					data:JSON.stringify(requestParams),
					success:function(dataObj){
						hideLoading();
						if(isServerResultDataPass(dataObj))
						{
							correctNotification({
								SimpleMessage:"删除成功。"
							});
							searchData();
						}else{
							FailResultDataToTip(dataObj);
						}
					}
				});
			}
		});
	}


	function exportData() {
		ExportToExcel.call($('#gridTable').jqGrid(), {
			FiledData: [{
				data_dictionary: Global_DicType.JS_STATE,
				filed: "js_state"
			}]
		});
	}


	var importData = function(){
		var  importUrl = "../../settlement/Js_Vin_AmountController/importBaobiaoData?t="+ Math.random();
		var  importTemplateUrl = "../../settlement/Js_Vin_AmountController/exportTemplateBaobiao?t="+ Math.random();

		if(!$("#fileUpload").zyUpload){
			alert("上传javascript插件未引入");
			return;
		}

		$("#fileUpload").zyUpload({
			itemWidth : "60px", // 文件项的宽度
			itemHeight : "60px", // 文件项的高度
			url : importUrl,
			multiple : false, // 是否可以多个文件上传
			dragDrop : true, // 是否可以拖动上传文件
			del : true, // 是否可以删除文件
			finishDel : false, // 是否在上传文件完成后删除预览
			close : true,
			fileTypeFilter : [ 'xls', 'xlsx' ],
			remark : "<p>只能上传xls/xlsx格式文件</p>",
			isDownModuleFile : true,
			downModuleFileUrl : importTemplateUrl,
			// 外部获得的回调接口
			onSelect : function(files, allFiles) { // 选择文件的回调方法
			},
			onDelete : function(file, surplusFiles) { // 删除一个文件的回调方法
			},
			onFailure : function(file) { // 文件上传失败的回调方法
			},
			onComplete : function(responseInfo) { // 上传完成的回调方法
				hideLoading();
				$("#fileUpload").empty();
				$("#fileUpload").hide();
				var dataObj = JSON.parse(responseInfo);
				if (isServerResultDataPass(dataObj)) {
					correctNotification({ SimpleMessage:dataObj.resultDataFull.simpleMessage });
					searchData();
				} else {
					FailResultDataToTip(dataObj);
				}
			}
		});
	}

/*    var comboChange = function(){
        var comboList = $(this).combobox("getValues");
        var comboText = $(this).combobox("getText").split(",");
        var newComboList = [];
        if(comboList!=null && comboList!=undefined){
            for(var i = 0 ; i < comboList.length ; i++){
                if(comboList[i]!=""){
					newComboList.push(comboList[i]);
                } else {
                    if(i!=0){
                        newComboList = [""];
                        break;
                    }
                }
            }
        }
        if(newComboList.length<=0){
            newComboList = [""];
        }
        $(this).combobox('setValues', newComboList);
    }*/

</script>
</body>
</html>
