<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="UTF-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/>
    <link id="CustomTheme" type="text/css" rel="stylesheet" href="../../Resource/css/index/customLightBlue.css" />
    <link id="EasyuiTheme" type="text/css" rel="stylesheet" href="../../Resource/js/easyUI/themes/easyuiLightBlue.css" />    
    <link id="JqgridTheme" type="text/css" rel="stylesheet" href="../../Resource/js/jqueryUI/theme/jqgridLightBlue/jquery-ui-1.10.4.custom.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/easyUI/themes/icon.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/moment/css/daterangepicker.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/jqueryUI/theme/ui.jqgrid.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/fileUpload/css/fileUpload.css" />
    <title>#{supplier.thisPage}</title>
</head>
<body>
    <div id="toolbar" class="easyui-panel" style="padding: 4px; border-width: 0; border-bottom-width: 1px;">
         #{PAGE_TOOLBAR_BUTTONROLE}
    </div>
    <div class="searchParamesPanel">
        <table id="searchParamesTable">
            <tr class="searchParamesTrShow">
            
             	<!-- <td class="searchParamesTdTitle">
                                       工厂编号
                </td>
                <td class="searchParamesTdControl">
                     <input type="text" name="werks" id="werks" class="easyui-textbox" />	
                </td> -->
                
                <td class="searchParamesTdTitle">
                	<label data-locale="contacts code"/>
                </td>
                <td class="searchParamesTdControl">
                    <input type="text" name="lifnr" id="lifnr" class="easyui-textbox" />
                </td>
                
                <td class="searchParamesTdTitle">
                    <label data-locale="contacts name"/>
                </td>
                <td class="searchParamesTdControl">
                    <input type="text" name="name1" id="name1" class="easyui-textbox" />
                </td>
                <td class="searchParamesTdTitle">
					<label data-locale="cus state"/>:
                </td>
                <td class="searchParamesTdControl">
                    <div id="divState"></div>
                </td>
                <!-- <td class="searchParamesTdTitle">
                    按钮:
                </td>
                <td class="searchParamesTdControl">
                    <button onclick="test()">button</button>
                </td> -->
            </tr>
        </table>
    </div>
    <div id="gridControl">
        <table id="gridTable">
        </table>
        <div id="gridPager">
        </div>
    </div>
     <div id="fileUpload" style="position: absolute; left: 50%; top: 50%; width: 600px;
        height: 400px; margin-left: -300px; margin-top: -200px; display: none;">
    </div>
    
    <div id="fileUploadByContacts" style="position: absolute; left: 50%; top: 50%; width: 600px;
        height: 400px; margin-left: -300px; margin-top: -200px; display: none;">
    </div>
    <div id="editData2" class="easyui-dialog" style="padding:5px;width:400px;height:360px;" title="客户详情录入"  data-options="closed:true">
		<form id="addForm" class="easyui-form" method="post">
	    	<table class="editTable">
		        <tr>
		            <td class="editRequiredTitle" >
		                	<label data-locale="contacts name"/>:
		            </td>
		            <td class="editControl">
		            <input type="hidden" id = "sn1"/>
		            <input type="hidden" id = "userId"/>
		            <span id="NAME1"></span>
		            </td>
		        </tr>
		         <tr>
		            <td class="editRequiredTitle" >
		                	<label data-locale="city"/>:
		            </td>
		            <td class="editControl">
		            	<input class="easyui-textbox" id="CITY1" name="CITY1" style="width: 157px;"/>
		            <span style="color:red;font-size:16px;text-align:center;">*</span>
		            </td>
		        </tr>
		        <tr>
		            <td class="editRequiredTitle" >
		                	<label data-locale="address"/>:
		            </td>
		            <td class="editControl">
		            	<input class="easyui-textbox" id="address1" name="address1" style="width: 157px;"/>
		            	<span style="color:red;font-size:16px;text-align:center;">*</span>
		            </td>
		        </tr>
		         <tr>
		            <td class="editRequiredTitle" >
		                	<label data-locale="contacts"/>:
		            </td>
		            <td class="editControl">
		            	<input class="easyui-textbox" id="LINKMAN1" name="LINKMAN1" style="width: 157px;"/>
		           		<span style="color:red;font-size:16px;text-align:center;">*</span>
		            </td>
		        </tr>
		         <tr>
		            <td class="editRequiredTitle" >
		                	<label data-locale="contacts tel"/>:
		            </td>
		            <td class="editControl">
		            	<input class="easyui-textbox" id="LINKTEL1" name="LINKTEL1" style="width: 157px;"/>
		            </td>
		        </tr>
		        		         <tr>
		            <td class="editRequiredTitle" >
		                	<label data-locale="contacts email"/>:
		            </td>
		            <td class="editControl">
		            	<input class="easyui-textbox" id="LINKMAIL1" name="LINKMAIL1" style="width: 157px;"/>
		            </td>
		        </tr>    
		        <tr>
		            <td class="editRequiredTitle" >
		                	<label data-locale="contacts"/>QQ:
		            </td>
		            <td class="editControl">
		            	<input class="easyui-textbox" id="LINKQQ1" name="LINKQQ1" style="width: 157px;"/>
		            </td>
		        </tr>
		        
		    </table>
		</form>
		<div id="dlg-buttons" style="margin-left:120px;margin-top:20px;">
			<a href="#" class="easyui-linkbutton" iconCls="icon-ok" onclick="javascript:ok()"><label data-locale="ok"/></a>&emsp;&emsp;
			<a href="#" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#editData2').dialog('close')"><label data-locale="cancel"/></a>
		</div>
	</div>
</body>
<script type="text/javascript"	src="../../Resource/js/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="../../Resource/js/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="../../Resource/js/jquery.i18n.properties.js"></script>
<script type="text/javascript" src="../../Resource/js/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/jquery.easyuiExtend.min.js"></script>
<script type="text/javascript" src="../../Resource/js/base/commonControl.js"></script>
<script type="text/javascript" src="../../Resource/js/base/globalVariable.js"></script>
<script type="text/javascript" src="../../Resource/js/base/commonBusiness.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/i18n/grid.locale-cn.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/jquery.jqGrid.min.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/plugins/grid.setcolumns.js"></script>
<script type="text/javascript" src="../../Resource/js/fileUpload/js/upload.js"></script>
<script type="text/javascript" src="../../Resource/js/fileUpload/js/file.js"></script>
<script language="javascript" type="text/javascript">
    var sn1="";
    var moduleId = 0;
    var werksInnerHTML = {'':'--#{all}--'};
    var transModeInnerHTML = {'':'--#{all}--'};
    var moduleidAuthority = "";
    var stateList = [
   		{
    		dicValue : "",
    		dicText : $.i18n.prop('all')
    		// dicText_en : $.i18n.prop('all')
   		},{
    		dicValue : "0",
    		dicText : $.i18n.prop('SysUsersManage_normal')
    		// dicText_en : $.i18n.prop('SysUsersManage_normal_en')
   		},{
    		dicValue : "1",
    		dicText : $.i18n.prop('SysUsersManage_invalid')
    		// dicText_en : $.i18n.prop('SysUsersManage_invalid_en')
   		}
   	];
    $(function () {
        var parms = getUrlParms();
        moduleId = parms["moduleId"];
        moduleidAuthority = parms["moduleId"];
        initScript();
        initData();
        initCodekeyDown();
    });

    var ee = function () {
        //获取列字段
        var colModel=$("#gridTable").jqGrid('getGridParam','colModel');
        var a = JSON.stringify(colModel)
        console.log(a)
        // console.log(colModel);
    }

    var test = function () {
        var colModel=$("#gridTable").jqGrid('getGridParam','colModel');
        var map = {
            column: colModel,
            filters: encodeURI(getSearchFilters())
        }
        $.ajax({
			url : '../../jcda/ZdCus/export',
			type : 'POST',
            contentType : "application/json",
			dataType : "json",
            data: JSON.stringify(map)
			// success : function(dataObj) {
			// 	if (isServerResultDataPass(dataObj)) 
			// 	{
			// 		var message = {};
			// 		message.autoHide=true;
			// 		message.moreMessage="";
			// 		message.showMoreMessage=false;
			// 		message.simpleMessage=dataObj.resultDataFull;
			// 		correctNotification(message);
			// 	} else 
			// 	{
			// 		FailResultDataToTip(dataObj);
			// 	}
			// }
		});
    }

    $(window).load(function () {
        hideLoading();
    });

    var oldSetGridHeightWidth = setGridHeightWidth;
    var setGridHeightWidth = function() {
    	oldSetGridHeightWidth(40,170);
    	oldSetGridHeightWidth(5, 128);
    };
    var initScript = function () {
    	showLog({id:"toolbar",operateModuleGlobal:"供应商档案",moduleId:moduleidAuthority});
    	var v = 0;
    	$(window).resize(function() {
    		if (v == 0) {
    			setTimeout(function() {
    				setGridHeightWidth();
    				v = 0;
    			}, 200)
    			v = 1;
    		}
    		setGridHeightWidth();
    		setToolbarHeightWidth();
    	});	
    } 
    var initData = function () {

        setTimeout(() => {
            loadTransMode();
        }, 1);
        
        setTimeout(() => {
            loadList();  
        
            var formatData = { data: stateList, needChooseAll: false, chooseAllValue: "", defaultValue: "",
            bindBoxName: "divState", bindControlPrefix: "state", onClick:function(){
                searchData();
            } };
            formatDefaultRadio_Local(formatData);
        }, 10);
    }
    
    var initCodekeyDown = function(){
    	$('#lifnr,#name1').textbox({
            inputEvents: $.extend({},$.fn.textbox.defaults.inputEvents,{
            	keyup:function(event){
            		if(event.keyCode == 13) {
           				searchData();
            		}
            	}   
         	})
      	});
    }
    
    var loadTransMode = function(){
    	$.ajax({  
            url:'../../scts/basic/findDictionaryByType?type=transportType',
            dataType: 'json',  
            method:"GET",
            success: function(data){
          	 data.forEach(function(item){
          		transModeInnerHTML[item.code] = item.code;
          	 });
            },
            error : function(){
          	  hideLoading();
            }
    	});
    }
    	

    function searchData() {
        $("#gridTable").jqGrid('setGridParam', {
            url: getSearchGridUrl(),
            datatype: 'json',
            postData: { "filters": "" },
            page: 1
        }).trigger("reloadGrid");
    }
    
    //从SAP更新数据
    var refreshBySAP = function() {
		$.ajax({
			url : '../../scts/supplier/SAPUpdates?t='+ Math.random(),
			type : 'GET',
			success : function(dataObj) {
				if (isServerResultDataPass(dataObj)) 
				{
					var message = {};
					message.autoHide=true;
					message.moreMessage="";
					message.showMoreMessage=false;
					message.simpleMessage=dataObj.resultDataFull;
					correctNotification(message);
				} else 
				{
					FailResultDataToTip(dataObj);
				}
			}
		});
    }
    
    var update = function () {
    	var ids = $('#gridTable').jqGrid('getGridParam','selarrrow');
    	if(ids.length>0){
    		if(ids.length>1){
    			errorNotification({ SimpleMessage : "#{customer_onlyEditOne}！"});
    			return;
    		}
    		var data = $('#gridTable').jqGrid('getRowData',ids[0]);
    		openDetail(data.SN,data.CODE);
			}else{
				errorNotification({ SimpleMessage : "#{SysUsersManage_selectgridrows}！"});
				return;
			}
    	}
    	

    var getSearchGridUrl = function () {
        return '../../jcda/ZdCus/find?t=' + Math.random() + '&customSearchFilters=' + encodeURI(getSearchFilters());
    }

    var getSearchFilters = function () {
//     	var val = $("#werks").combobox("getText");
    	
        var parmsArray = [
          { name: 'a.code', value: $("#lifnr").val(), op: "cn" },
//           { name: 'within_code', value: val.indexOf("--")==-1?val:"" , op: "eq" },
          { name: 'a.name', value: $("#name1").val(), op: "cn" },
          { name: 'a.state', value: $("#divState [name=state]:checked").val(), op: "eq" }
        ];
        return formatSearchParames(parmsArray);
    }

    var add = function () {
        openDetail("");
    }
    
    var showChild = function(obj){
    	var paramFilter = "&code="+obj.lifnr+"&within_code="+obj.werks+"&name="+obj.name1;
        var href = "../View/BaseInfo/SupplierChild.html?moduleId=" + moduleId + encodeURI(paramFilter);
        createNewTab($.i18n.prop('supplier.page.detail.title'), href);
    }

    var openDetail = function (code,cusId) {
    	showLoading("#{supplier.page.detail.title}...");
        var href = "../View/BaseInfo/customerDetailList.html?moduleId=" + moduleId+"&sn=" + code + "&cusId=" + cusId;
        openDialog({ title: $.i18n.prop('customer_customerDetail'), id: 'SupplierDetail', width: 1000, height: 600, isResize: true, href: href, closable: true });
    }

    var loadList = function () {
        $("#gridTable").jqGrid({
            url: getSearchGridUrl(),
            datatype: "json",
            width: "none",
            colNames: ['',$.i18n.prop('state'),$.i18n.prop('within code'),$.i18n.prop('type'),$.i18n.prop('cus_no'),
                       $.i18n.prop('cus'),$.i18n.prop('new city'),$.i18n.prop('linkman'),$.i18n.prop('phone'),$.i18n.prop('Email'),'QQ'],
            colModel: [
            { name: 'SN', index: 'SN',  key: true,align: 'center', sorttype: 'int', search: false, sortable: false, width: 40, hidden: true },
            {name: 'STATE', index: 'STATE',hidden: false, align: 'center', width: 60, type: 'string', search: true,formatter: function (value, grid, row){
 					if(row.STATE==0){
 						return $.i18n.prop('normal');
 					}
 					if(row.STATE == 1){
 						return $.i18n.prop('Invalid');
 					}
 					
                 } },
            {name: 'WITHIN_CODE',hidden:true, index: 'WITHIN_CODE', align: 'center', width: 60, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne']}},
            {name: 'KIND', index: 'KIND', align: 'center',hidden: false, width: 60, type: 'string', search: true,formatter: function (value, grid, row){
 					if(row.KIND=='1'){
 						return $.i18n.prop('customer_customerTypeFocus');
 					}
 					if(row.KIND == '2'){
 						return $.i18n.prop('customer_customerTypeRegular');
 					}
 					if(row.KIND == '3'){
 						return $.i18n.prop('customer_customerTypeGeneral');
 					}
 				}},
            {hidden: false,name: 'CODE', index: 'CODE', align: 'center', width: 60, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne']}},
            {hidden: false, name: 'NAME', index: 'NAME', align: 'center', width: 180, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne']} },
            {hidden: false,name: 'CITY', index: 'CITY', align: 'center', width: 100, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne']}},
            {hidden: false, name: 'LINKMAN', index: 'LINKMAN', align: 'center', width: 80, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne']} },
            {hidden: false, name: 'LINKTEL', index: 'LINKTEL', align: 'center', width: 120, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne']} },
            {hidden: false,name: 'LINKMAIL', index: 'LINKMAIL', align: 'center', width: 120, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne']}},
            {hidden: false,name: 'LINKQQ', index: 'LINKQQ', align: 'center', width: 120, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne']}}
//             {name: 'aa', index: 'aa', align: 'center', width: 120, type: 'string', search: true, searchoptions: { sopt: ['cn', 'eq', 'ne']},formatter: function (id, grid, row){
//             	return '<a href="#" class="easyui-linkbutton" plain="true" iconCls="icon-refresh" onclick="edit2('+row.SN+');">编辑</a>'
//  				} }
            ],
            shrinkToFit: false,
            altRows: true,
            altclass: 'gridSpacingClass',
            forceFit: true,
            cellLayout: 0,
            scroll: false,
            autowidth: true,
            sortname: 'code',
            sortorder: "asc", 
            loadonce: false,
            mtype: "POST",
            viewrecords: true,
            rownumbers: true,
            multiselect: true,
            rowNum: 15,
            height: "100%",
            rowList: [15, 20, 30, 50],
            pager: "#gridPager",
            jsonReader: {
                root: "rows",
                total: "total",
                page: "page",
                records: "records",
                repeatitems: false
            },
            gridComplete: function () {
                $(".cbox").shiftSelect();
                afterRedRow();
            },
            ondblClickRow: function (index,row,i) {
            	update();
            },
            loadComplete: function (xhr) {
                $('.gridViewPicLink').tooltip({
                    position: 'bottom',
                    content: $(this).attr("title"),
                    onShow: function () {
                        $(this).tooltip('tip').css({
                            backgroundColor: '#FCF8E3',
                            borderColor: '#FAEBCC'
                        });
                    }
                });
                FailResultDataToTip(xhr);
            }
        });

        $("#gridTable").jqGrid('navGrid', '#gridPager', { add: false, edit: false, del: false, refresh: true,search: false }, {}, {}, {}, { multipleSearch: true, closeOnEscape: true, closeAfterSearch: true });
        $("#gridTable").jqGrid('navButtonAdd', '#gridPager', {
            caption: $.i18n.prop('customer_setCloumn'),
            title: $.i18n.prop('customer_setCloumn'),
            onClickButton: toggleGridColumns
        });

        $("#gridTable").jqGrid('navButtonAdd', '#gridPager', {
            caption: $.i18n.prop('customer_quickSearch'),
            title: $.i18n.prop('customer_quickSearch'),
            onClickButton: toggleGridSearchToolbar
        });
        
        $("#gridTable").jqGrid('navButtonAdd', '#gridPager', {
            caption: $.i18n.prop('customer_exportData'),
            title: $.i18n.prop('customer_exportData'),
            buttonicon: "ui-icon-disk",
            onClickButton: function(){
           	ExportToExcel.call(this, {
           		 url : "../../jcda/ZdCus/export?t=" + Math.random()
           	 }); 
            }
        });
        setGridHeightWidth();
    }

    var refreshCallerData_zdTruckType = function () {
        searchData();
    }
    
    var importContacts = function(){
    	if($("#fileUpload").css("display")!="none"){
    		$("#fileUpload").css("display","none");
    		$("#fileUploadByContacts").css("display","block");
    	}
    	var url = '../../scts/supplier/importUserMailExcel?t=' + Math.random();
        $("#fileUploadByContacts").zyUpload({
            itemWidth: "60px", // 文件项的宽度
            itemHeight: "60px", // 文件项的高度
            url: url,
            multiple: false, // 是否可以多个文件上传
            dragDrop: true, // 是否可以拖动上传文件
            del: true, // 是否可以删除文件
            finishDel: false, // 是否在上传文件完成后删除预览
            close: true,
            fileTypeFilter: ['xls', 'xlsx'],
            remark: "<p>#{supplier.message.excelValid}</p>",
            isDownModuleFile: true,
            downModuleFileUrl: '../../scts/supplier/exportUserMailExcelModel?t=' + Math.random(),
            /* 外部获得的回调接口 */
            onSelect: function (files, allFiles) { // 选择文件的回调方法
            },
            onDelete: function (file, surplusFiles) { // 删除一个文件的回调方法
            },
            onSuccess: function (file) { // 文件上传成功的回调方法
            },
            onFailure: function (file) { // 文件上传失败的回调方法
            },
            onComplete: function (responseInfo) { // 上传完成的回调方法
            	hideLoading();
                var dataObj = JSON.parse(responseInfo);
                if (isServerResultDataPass(dataObj)) {
                	 searchData();
                	 hideLoading();
                     correctNotification(dataObj.resultDataFull);
                } else {
                    FailResultDataToTip(dataObj);
                }
                $("#fileUploadByContacts").empty();
                $("#fileUploadByContacts").hide();
            }
        });
    }
    
    var importData = function () {
    	
    	if($("#fileUploadByContacts").css("display")!="none"){
    		$("#fileUploadByContacts").css("display","none");
    		$("#fileUpload").css("display","block");
    	}
    	
        var url = "../../scts/supplier/importExcel?t=" + Math.random();
        $("#fileUpload").zyUpload({
            itemWidth: "60px", // 文件项的宽度
            itemHeight: "60px", // 文件项的高度
            url: url,
            multiple: false, // 是否可以多个文件上传
            dragDrop: true, // 是否可以拖动上传文件
            del: true, // 是否可以删除文件
            finishDel: false, // 是否在上传文件完成后删除预览
            close: true,
            fileTypeFilter: ['xls', 'xlsx'],
            remark: "<p>#{supplier.message.excelValid}</p>",
            isDownModuleFile: true,
            downModuleFileUrl: "../../scts/supplier/exportExcelModel?t=" + Math.random(),
            /* 外部获得的回调接口 */
            onSelect: function (files, allFiles) { // 选择文件的回调方法
            },
            onDelete: function (file, surplusFiles) { // 删除一个文件的回调方法
            },
            onSuccess: function (file) { // 文件上传成功的回调方法
            },
            onFailure: function (file) { // 文件上传失败的回调方法
            },
            onComplete: function (responseInfo) { // 上传完成的回调方法
            	hideLoading();
                var dataObj = JSON.parse(responseInfo);
                if (isServerResultDataPass(dataObj)) {
                	 searchData();
                	 hideLoading();
                     correctNotification(dataObj.resultDataFull);
                } else {
                    FailResultDataToTip(dataObj);
                }
                $("#fileUpload").empty();
                $("#fileUpload").hide();
            }
        });
    }
    
    function edit2(sn){
    	$.get('../../jcda/ZdCus/findByUserId',{sn:sn},function(data){
    		$('#editData2').dialog({closed:false});
    		 $('#NAME1').text(data.NAME);
    		 $('#CITY1').textbox('setValue',data.CITY);
    		 $('#LINKMAN1').textbox('setValue',data.LINKMAN);
    		 $('#LINKTEL1').textbox('setValue',data.LINKTEL);
    		 $('#LINKMAIL1').textbox('setText',data.LINKMAIL);
    		 $('#LINKQQ1').textbox('setText',data.LINKQQ);
    		 $('#address1').textbox('setText',data.ADDRESS);
    		 $("#sn1").val(data.SN);
    		 $("#userId").val(data.CUS_ID);
    	});
    }
    
    function ok(){
		 var CITY = $('#CITY1').textbox('getValue');
		 var LINKMAN = $('#LINKMAN1').textbox('getValue');
		 var LINKTEL = $('#LINKTEL1').textbox('getValue');
		 var LINKMAIL = $('#LINKMAIL1').textbox('getText');
		 var LINKQQ = $('#LINKQQ1').textbox('getText');
		 var  address1 = $('#address1').textbox('getText');
		 var sn = $("#sn1").val();
		 var userId = $("#userId").val();
		 var url;
		 var data = {'city':CITY,'linkman':LINKMAN,'linktel':LINKTEL,'linkmail':LINKMAIL,'cus_id':sn,'address':address1,'linkqq':LINKQQ};
		 if(userId =="" || userId == null){
			 $.post("../../jcda/ZdCus/addAddress?t=" + Math.random(),data,function(data){
					if(data.resultCode == "0"){
   	            		correctNotification(data.resultDataFull);
	    	            	$('#editData2').dialog({closed:true});
	    	            	searchData();
   	            	}else{
   	            		errorNotification({ SimpleMessage : data.resultDataFull.simpleMessage});	
   	            	}
			 });
		 }else{
			 $.post("../../jcda/ZdCus/updateAddress?t=" + Math.random(),data,function(data){
					if(data.resultCode == "0"){
   	            		correctNotification(data.resultDataFull);
	    	            	$('#editData2').dialog({closed:true});
	    	            	searchData();
   	            	}else{
   	            		errorNotification({ SimpleMessage : data.resultDataFull.simpleMessage});	
   	            	}
			 });
		 }

    }
    
	// function zhuxiao(){
	// 	$.messager.confirm("注销", "确认注销?",function(r){
	// 	    if(r){
	// 	    	var ids = $('#gridTable').jqGrid('getGridParam','selarrrow');
	// 			var sn = "";
	// 	    	for (var i = 0; i < ids.length; i++) {
	// 	    		var rowData = $('#gridTable').jqGrid('getRowData',ids[i]);
	// 	    		sn +=rowData.SN+",";
	// 			}
	// 				$.get('../../jcda/ZdCus/zhuxiao?SNS='+sn,function(data){
	// 					if(data.resultCode == "0"){
	// 		            		correctNotification(data.resultDataFull);
	// 	    	            	searchData();
	// 		            	}else{
	// 		            		errorNotification({ SimpleMessage : data.resultDataFull.simpleMessage});	
	// 		            	}
	// 	   		});
	// 	    }});
    // }
    
    var setState0 = function () {
        setState('1');
    }

    var setState1 = function () {
        setState('0');
    }
    
    var setState = function (kind) {
        var selectRowItems = $("#gridTable").jqGrid("getGridParam", "selarrrow");
        if (selectRowItems.length <= 0) {
            errorNotification({ SimpleMessage: $.i18n.prop('SysUsersManage_selectgridrows') });
            return;
        }

        var messKind = '';
        if (kind == '1')
            messKind = $.i18n.prop('SysUsersManage_invalid');
        else
             messKind = $.i18n.prop('SysUsersManage_valid');
        var error = '';
        var idArray = [];
        for (var i = 0, ilen = selectRowItems.length; i < ilen; i++) {
            var rowData = $("#gridTable").jqGrid('getRowData', selectRowItems[i]);
            var item = {
                wiCode : null,
                code: null
            }
            item.code = rowData.CODE
            item.wiCode = rowData.WITHIN_CODE
            idArray.push(item);
            var level = '0';
        }
        if (error != '')
        {
            errorNotification({ SimpleMessage: error });
            return;
        }
 
        messKind = $.i18n.prop('SysUsersManage_determine')+messKind+$.i18n.prop('SysUsersManage_determineuser');
        $.messager.confirm($.i18n.prop('SysUsersManage_alert'), messKind, function (r) {
            if (r) {
            	var url="../../jcda/ZdCus/cusState?t="+Math.random();
                showLoading();
                $.getJSON(url, {kind: kind, json: JSON.stringify(idArray)},
                    function (data) {
                        if (isServerResultDataPass(data)) {
                            searchData();
                            correctNotification({
                                SimpleMessage: data.resultDataFull.simpleMessage
                            });
                        } else {
                            FailResultDataToTip(data);
                        }
                        hideLoading();
                    });
            }
        });
    }

    var afterRedRow = function () {
        var ids = $("#gridTable").jqGrid("getDataIDs");
        for (var i = 0; i < ids.length; i++) {
            var rowData = $("#gridTable").getRowData(ids[i]);
            if (rowData.STATE == '1' || rowData.STATE == $.i18n.prop('SysUsersManage_invalid') || rowData.STATE == '已注销') {
                $('#gridTable #' + ids[i]).find("td").css('color', "red");
            }
        }
    }
  </script>
</html>