<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<link id="CustomTheme" type="text/css" rel="stylesheet" href="../../Resource/css/index/customLightBlue.css" />
	<link id="EasyuiTheme" type="text/css" rel="stylesheet" href="../../Resource/js/easyUI/themes/easyuiLightBlue.css" />
	<link id="JqgridTheme" type="text/css" rel="stylesheet" href="../../Resource/js/jqueryUI/theme/jqgridLightBlue/jquery-ui-1.10.4.custom.css" />
	<link type="text/css" rel="stylesheet" href="../../Resource/js/jqueryUI/theme/ui.jqgrid.css" />
	<link type="text/css" rel="stylesheet" href="../../Resource/js/easyUI/themes/icon.css" />
	<link type="text/css" rel="stylesheet" href="../../Resource/js/fileUpload/css/fileUpload.css" />
	<title>台账明细</title>

	<style type="text/css">
		.editTable{
			margin-top: 1px;
			padding-top: 0px;
			padding-left: 0px;
			margin-left: 0px;
		}
		.editTable .datebox input[readonly="readonly"]{
			background-color: initial;
		}
	</style>
</head>
<body>
<div id="toolbar" class="easyui-panel" style="padding:4px;border-width:0;border-bottom-width:1px;">
	#{PAGE_TOOLBAR_BUTTONROLE}
</div>
<div class="searchParamesPanel editTable">
	<form class="easyui-form panel-noscroll" enctype="multipart/form-data">
		<table class="editTable">
			<tr>
				<td class="editTitle" style="width:125px;"><label data-locale="SHEET_NO"/></td>
				<td class="editControl">
					<input type="text" name="sheet_no" id="sheet_no" class="easyui-textbox" data-options="required:true" readonly="readonly" style="width: 100%;"/>
				</td>

				<td class="editTitle" style="width:125px;"><label data-locale="CUS_NAME"/></td>
				<td class="editControl">
					<input type="text" name="cus_no" id="cus_no" class="easyui-combobox" style="width: 100%;"/>
				</td>
				<td class="editTitle" style="width:125px;"><label data-locale="CONTRACT_NO"/></td>
				<td class="editControl">
					<input type="text" name="contract_no" id="contract_no" readonly="readonly" class="easyui-textbox" style="width: 100%;"/>
				</td>
				<td class="editTitle" style="width:125px;"><label data-locale="STATE"/></td>
				<td class="editControl">
					<input type="text" name="state" id="state" class="easyui-textbox" readonly="readonly" style="width: 100%;"/>
				</td>
			</tr>

			<tr>
				<td class="editTitle" style="width:125px;"><label data-locale="LEDGER_NO"/></td>
				<td class="editControl">
					<input type="text" name="ledger_no" id="ledger_no" data-options="required:true" class="easyui-textbox"  style="width: 100%;"/>
				</td>
				<td class="editTitle" style="width:125px;"><label data-locale="JS_NO"/></td>
				<td class="editControl">
					<input type="text" name="js_no" id="js_no" data-options="required:true" class="easyui-textbox"  style="width: 100%;"/>
				</td>
				<td class="editTitle" style="width:125px;"><label data-locale="JS_PROJECT"/></td>
				<td class="editControl">
					<input type="text" name="js_project" id="js_project" data-options="required:true" class="easyui-textbox"  style="width: 100%;"/>
				</td>
				<td class="editTitle" style="width:125px;"><label data-locale="LEDGER_TYPE"/></td>
				<td class="editControl">
					<input type="text" name="ledger_type" id="ledger_type" class="easyui-textbox" readonly="readonly" style="width: 100%;"/>
				</td>
			</tr>
			<tr>
				<td class="editTitle" style="width:125px;"><label data-locale="TAX_UP_TOTAL"/></td>
				<td class="editControl">
					<input type="text" name="tax_up_total" id="tax_up_total" data-options="required:true,precision:2" readonly="readonly" class="easyui-numberbox" style="width: 100%;"/>
				</td>
				<td class="editTitle" style="width:125px;"><label data-locale="NTAX_UP_TOTAL"/></td>
				<td class="editControl">
					<input type="text" name="ntax_up_total" id="ntax_up_total" data-options="required:true,precision:2" readonly="readonly" class="easyui-numberbox" style="width: 100%;"/>
				</td>
				<td class="editTitle" style="width:125px;"><label data-locale="TAX_AMOUNT"/></td>
				<td class="editControl">
					<input type="text" name="tax_amount" id="tax_amount" data-options="required:true,precision:2" readonly="readonly" class="easyui-numberbox" style="width: 100%;"/>
				</td>
				<td class="editTitle" style="width:125px;"><label data-locale="INVOICE_NO"/></td>
				<td class="editControl">
					<input type="text" name="invoice_no" id="invoice_no" class="easyui-textbox" readonly="readonly" style="width: 100%;"/>
				</td>
			</tr>

			<tr>
				<td class="editTitle" style="width:125px;"><label data-locale="TAX_DOWN_TOTAL"/></td>
				<td class="editControl">
					<input type="text" name="tax_down_total" id="tax_down_total" data-options="required:true,precision:2" readonly="readonly" class="easyui-numberbox" style="width: 100%;"/>
				</td>
				<td class="editTitle" style="width:125px;"><label data-locale="NTAX_DOWN_TOTAL"/></td>
				<td class="editControl">
					<input type="text" name="ntax_down_total" id="ntax_down_total" data-options="required:true,precision:2" readonly="readonly" class="easyui-numberbox" style="width: 100%;"/>
				</td>
				<td class="editTitle" style="width:125px;"><label data-locale="NOT_TAX_PROFIT"/></td>
				<td class="editControl">
					<input type="text" name="not_tax_profit" id="not_tax_profit" data-options="required:true,precision:2" readonly="readonly" class="easyui-numberbox" style="width: 100%;"/>
				</td>
				<td class="editTitle" style="width:125px;"><label data-locale="TAX_RATE"/></td>
				<td class="editControl">
					<input type="text" name="tax_rate" id="tax_rate" data-options="required:true" readonly="readonly" class="easyui-numberbox"  style="width: 100%;"/>
				</td>
			</tr>

			<tr>
				<td class="editTitle" style="width:125px;"><label data-locale="CREATE_BY"/></td>
				<td class="editControl">
					<input type="text" name="create_by" id="create_by" class="easyui-textbox" readonly="readonly" style="width: 100%;" />
				</td>
				<td class="editTitle" style="width:125px;"><label data-locale="CHECK_BY"/></td>
				<td class="editControl">
					<input type="text" name="check_by" id="check_by" class="easyui-textbox" readonly="readonly" style="width: 100%;"/>
				</td>
				<td class="editTitle" style="width:125px;"><label data-locale="INVOICE_COMPANY"/></td>
				<td class="editControl">
					<input type="text" name="invoice_company" id="invoice_company" class="easyui-combobox" style="width: 100%;"/>
				</td>
				<td class="editTitle" style="width:125px;"><label data-locale="REMARK"/></td>
				<td class="editControl">
					<input type="text" name="remark" id="remark" class="easyui-textbox"  style="width: 100%;" />
				</td>
			</tr>
		</table>
	</form>
</div>
<div id="gridControl">
	<table id="gridTable"></table>
	<div id="gridPager"></div>
</div>
<div id="fileUpload" style="position: absolute; left: 50%; top: 50%;
	 width: 600px; height: 400px; margin-left: -300px; margin-top: -200px; display: none;"></div>
<script type="text/javascript" src="../../Resource/js/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="../../Resource/js/jquery.i18n.properties.js"></script>
<script type="text/javascript" src="../../Resource/js/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="../../Resource/js/base/commonControl.js"></script>
<script type="text/javascript" src="../../Resource/js/base/commonBusiness.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/i18n/grid.locale-cn.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/jquery.jqGrid.min.js"></script>
<script type="text/javascript" src="../../Resource/js/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="../../Resource/js/base/globalVariable.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/plugins/grid.setcolumns.js"></script>
<script type="text/javascript" src="../../Resource/js/cookie/jquery.cookie.js"></script>
<script type="text/javascript" src="../../Resource/js/fileUpload/js/upload.js"></script>
<script type="text/javascript" src="../../Resource/js/fileUpload/js/file.js"></script>
<script language="javascript" type="text/javascript">
    $(function() {
        initScript();
        initStyle();
        loadList();
        initData();
        var parms = getUrlParms();
        if(parms.sheet_no){
            window.parent.onIframeSelect(parms.sheet_no);
        }

    });

    $(window).load(function() { hideLoading(); });

    var initStyle = function() {};

    var initScript = function() {};

    // 加载数据
    var initData = function() {

        getDictionaryData([{
            //初始化台账状态数据字典
            dicTypeCode : Global_DicType.Ledger_State,
            ADD_ALL: true,
            callback : function(callbackData) {
                window.Ledger_StateMap = {};
                for(var i = 0; i < callbackData.length; i++){
                    Ledger_StateMap[callbackData[i].dicvalue] = callbackData[i].dictext;
                }
            }
        },{
            //初始化台账类型数据字典
            dicTypeCode : Global_DicType.Ledger_Type,
            ADD_ALL: true,
            callback : function(callbackData) {
                window.Ledger_TypeMap = {};
                for(var i = 0; i < callbackData.length; i++){
                    Ledger_TypeMap[callbackData[i].dicvalue] = callbackData[i].dictext;
                }
            }
        },{
            //初始化状态数据字典
            dicTypeCode : Global_DicType.Global_DicType_CommonStateYesNo,
            callback : function(callbackData) {
                window.CommonStateMap = {};
                for(var i = 0; i < callbackData.length; i++){
                    CommonStateMap[callbackData[i].dicvalue] = callbackData[i].dictext;
                }
            }
        }]);

        getBaseData([{
            //初始化客户档案
            dicTypeCode : Global_BaseDataKey.CR_CUSTOMER,
            callback : function(callbackData) {
                $("#cus_no,#invoice_company").combobox({
                    valueField: 'code',
                    textField: 'name',
                    panelHeight: 200,
                    editable: true
                });
                $("#cus_no,#invoice_company").combobox("loadData", callbackData);
            }
        }]);

    };

    function remove(){
        loseGridFocus();
        $.messager.confirm('提示', '确认对该台账进行注销操作吗?', function (r) {
            if (r) {
                showLoading();
                var requestParam = {};
                requestParam.sheet_no = $("#sheet_no").textbox("getValue");
                $.ajax({
                    url :"../../tzgl/LedgerController/cancel?t=" + Math.random(),
                    data: requestParam,
                    success : function(dataObj){
                        if (isServerResultDataPass(dataObj)) {
                            loadDetail({
                                sheet_no : $("#sheet_no").textbox("getValue"),
                                msg : dataObj.resultDataFull
                            });
                        } else {
                            FailResultDataToTip(dataObj);
                            hideLoading();
                        }
                    }
                });
            }
        });
    }

    function check(){
        loseGridFocus();
        $.messager.confirm('提示', '确认对该台账进行审核操作吗?', function (r) {
            if (r) {
                showLoading();
                var requestParam = {};
                requestParam.sheet_no = $("#sheet_no").textbox("getValue");
                $.ajax({
                    url :"../../tzgl/LedgerController/check?t=" + Math.random(),
                    data: requestParam,
                    success : function(dataObj){
                        if (isServerResultDataPass(dataObj)) {
                            loadDetail({
                                sheet_no : $("#sheet_no").textbox("getValue"),
                                msg : dataObj.resultDataFull
                            });
                        } else {
                            FailResultDataToTip(dataObj);
                            hideLoading();
                        }
                    }
                });
            }
        });
    }

    function uncheck(){
        loseGridFocus();
        $.messager.confirm('提示', '确认对该台账进行反审核操作吗?', function (r) {
            if (r) {
                showLoading();
                var requestParam = {};
                requestParam.sheet_no = $("#sheet_no").textbox("getValue");
                $.ajax({
                    url :"../../tzgl/LedgerController/uncheck?t=" + Math.random(),
                    data: requestParam,
                    success : function(dataObj){
                        if (isServerResultDataPass(dataObj)) {
                            loadDetail({
                                sheet_no : $("#sheet_no").textbox("getValue"),
                                msg : dataObj.resultDataFull
                            });
                        } else {
                            FailResultDataToTip(dataObj);
                            hideLoading();
                        }
                    }
                });
            }
        });
    }

    function add() {
        $.messager.confirm('提示', '确定打开一个新界面?', function (r) {
            if (r) {
                showLoading();
                add_after();
            }
        });
    };

    function add_after(){
        location.href = location.pathname;
    }

    var saveValidationPass = function () {
        var validated = $("form").form('enableValidation').form('validate');
        if (!validated) {
            errorNotification({
                SimpleMessage: "保存操作中部分数据验证不通过"
            });
            return false;
        } else {
            return true;
        }
    }

    function save() {
        loseGridFocus();
        if (!saveValidationPass()) {
            return;
        }
        $.messager.confirm('提示', '确定保存吗?', function (r) {
            if(r){
                showLoading();
                save_after();
            }
        });
    }

    function save_after(){
        loseGridFocus();
        var ledger_DetailVOList = $("#gridTable").jqGrid("getRowData");
        for (var i = 0; i < ledger_DetailVOList.length; i++) {
            var curRowData = ledger_DetailVOList[i];
            if(curRowData.operator == "add"){
                curRowData.sn = "";
            }
            curRowData.tax_rate = curRowData.tax_rate.replace("%","")/100;
            curRowData.carrier_invoice = curRowData.carrier_invoice=="是"?"Y":"N";
            delete curRowData.operator;
        }

        var requestParam = {};
        requestParam.ledgerVO = FormUtils.toJSONObject('form');
        requestParam.ledgerVO.tax_rate = $("#tax_rate").textbox("getValue")/100;
        requestParam.ledger_DetailVOList = ledger_DetailVOList;
        delete requestParam.ledgerVO.ledger_type;
        $.ajax({
            url :"../../tzgl/LedgerController/saveDetail?t=" + Math.random(),
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify(requestParam),
            success : function(dataObj){
                if (isServerResultDataPass(dataObj)) {
                    loadDetail({
                        sheet_no : dataObj.resultDataFull.sheet_no,
                        msg : { simpleMessage : dataObj.resultDataFull.msg }
                    });
                } else {
                    FailResultDataToTip(dataObj);
                    hideLoading();
                }
            }
        });
    }

/*    var remove_detail = function() {
        loseGridFocus();
        var $gridObject = $("#gridTable");
        var selectRowItems = $gridObject.jqGrid("getGridParam", "selarrrow");
        if (selectRowItems.length == 0) {
            errorNotification({
                SimpleMessage : "请至少选择一行数据行进行操作"
            });
            return;
        }
        $.messager.confirm('提示', '确定删除选中的数据项吗?', function(r) {
            if (r) {
                for (var i = selectRowItems.length-1; i >= 0;i--) {
                    $gridObject.jqGrid("delRowData", selectRowItems[i]);
                }
            }
        });
    };*/
    // 加载数据详细信息
    var loadDetail = function(requestParam) {
        showLoading();
        $.ajax({
            url: '../../tzgl/LedgerController/getDetail?t=' + Math.random(),
            type: 'POST',
            data: "sheet_no="+requestParam.sheet_no,
            success : function(dataObj) {
                if (isServerResultDataPass(dataObj)) {
                    var ledgerVO = dataObj.resultDataFull.ledgerVO;
                    var ledger_DetailVOList = dataObj.resultDataFull.ledger_DetailVOList;
                    myDisabled($("#ledger_no"))
                    $("#state").textbox("setValue", window.Ledger_StateMap[ledgerVO.state]);
                    $("#ledger_type").textbox("setValue", window.Ledger_TypeMap[ledgerVO.ledger_type]);
                    $("#sheet_no").textbox("setValue", ledgerVO.sheet_no);
                    $("#ledger_no").textbox("setValue", ledgerVO.ledger_no);
                    $("#contract_no").textbox("setValue", ledgerVO.contract_no);
                    $("#js_project").textbox("setValue", ledgerVO.js_project);
                    $("#js_no").textbox("setValue", ledgerVO.js_no);
                    $("#cus_no").combobox("setValue", ledgerVO.cus_no);
                    $("#invoice_company").combobox("setValue", ledgerVO.invoice_company);
                    $("#remark").textbox("setValue", ledgerVO.remark);
                    $("#invoice_no").textbox("setValue", ledgerVO.invoice_no);
                    $("#ntax_up_total").numberbox("setValue", ledgerVO.ntax_up_total);
                    $("#tax_up_total").numberbox("setValue", ledgerVO.tax_up_total);
                    $("#tax_amount").numberbox("setValue", ledgerVO.tax_amount);
                    $("#tax_rate").numberbox("setValue", ledgerVO.tax_rate*100);
                    $("#tax_down_total").numberbox("setValue", ledgerVO.tax_down_total);
                    $("#not_tax_profit").numberbox("setValue", ledgerVO.not_tax_profit);
                    $("#ntax_down_total").numberbox("setValue", ledgerVO.ntax_down_total);
                    $("#create_by").textbox("setValue", ledgerVO.create_by+" "+ledgerVO.create_date);
                    if(ledgerVO.check_by){
                        $("#check_by").textbox("setValue", ledgerVO.check_by+" "+ledgerVO.check_date);
                    }
                    $("#gridTable")[0].addJSONData({
                        rows: ledger_DetailVOList,
                        total: "1",
                        page: "1",
                        records: ledger_DetailVOList.length
                    });
                    if(requestParam.msg){
                        correctNotification(requestParam.msg);
                    }
                } else {
                    FailResultDataToTip(dataObj);
                }
                hideLoading();
            }
        });
    };

    var add_detail = function (vo) {
        loseGridFocus();
        $("#gridTable").common_add({
            data : vo/*,
            isFirstClick : true*/
        });
    };

    var loadList = function() {
        $("#gridTable").jqGrid({
            url : "",
            datatype : "local",
            width : "none",
            autoCol : false,
            colNames : [
                'operator',
                'ID',
                $.i18n.prop('SHEET_NO'),
                $.i18n.prop('JS_NO'),
                $.i18n.prop('JS_PROJECT'),
                $.i18n.prop('CARRIER_NO'),
                $.i18n.prop('CARRIER_NAME'),
                $.i18n.prop('NTAX_DOWN_TOTAL'),
                $.i18n.prop('TAX_DOWN_TOTAL'),
                $.i18n.prop('TAX_RATE'),
                /*$.i18n.prop('CARRIER_INVOICE'),*/
                $.i18n.prop('INVOICE_NO'),
                'PREMIUM_FLAG',
                $.i18n.prop('REMARK')
            ],
            colModel : [
                { name: 'operator', index: 'operator', hidden: true, sortable : false, search: false },
                { name: 'id', index: 'id', hidden: true, sortable : false, search: false, key: true },
                { name: 'sheet_no', index: 'sheet_no', sortable : false, align: 'left', width: 150, search: true, searchoptions: { sopt : [ 'cn', 'eq', 'ne' ] }},
                { name: 'js_no', index: 'js_no', sortable : false, align: 'left', width: 150, search: true, searchoptions: { sopt : [ 'cn', 'eq', 'ne' ] }, editable:true, editrules:{} },
                { name: 'js_project', index: 'js_project', sortable : false, align: 'left', width: 150, search: true, searchoptions: { sopt : [ 'cn', 'eq', 'ne' ] }, editable:true, editrules:{} },
                { name: 'carrier_no', index: 'carrier_no', sortable : false, align: 'left', width: 100, search: true, searchoptions: { sopt : [ 'cn', 'eq', 'ne' ] } },
                { name: 'carrier_name', index: 'carrier_name', sortable : false, align: 'left', width: 200, search: true, searchoptions: { sopt : [ 'cn', 'eq', 'ne' ] } },
                { name: 'ntax_down_total', index: 'ntax_down_total', sortable : false, align: 'left', width: 120, search: true, searchoptions: { sopt : [ 'cn', 'eq', 'ne' ] }
                    ,formatter: function (value, grid, rows) {
                        return rows.ntax_down_total.toFixed(2);
                    }},
                { name: 'tax_down_total', index: 'tax_down_total', sortable : false, align: 'left', width: 120, search: true, searchoptions: { sopt : [ 'cn', 'eq', 'ne' ] }
                    ,formatter: function (value, grid, rows) {
                        return rows.tax_down_total.toFixed(2);
                    }},
                { name: 'tax_rate', index: 'tax_rate', sortable : false, align: 'left', width: 100, search: true, searchoptions: { sopt : [ 'cn', 'eq', 'ne' ] }
                    ,formatter: function (value, grid, rows) {
                        var tax_rate=rows.tax_rate;
                        if(tax_rate>0)
                        {
                            tax_rate= (tax_rate*100).toString()+"%";
                        }
                        return tax_rate;
                    }},
            /*    { name: 'carrier_invoice', index: 'carrier_invoice', align: 'center', width: 70, search: false, sortable: false, formatter: function (value, grid, rows) {
                        return window.CommonStateMap[value];
                    },hidden:true},*/
                { name: 'invoice_no', index: 'invoice_no', sortable : false, align: 'left', width: 150, search: true, searchoptions: { sopt : [ 'cn', 'eq', 'ne' ] }},
                { name: 'premium_flag', index: 'premium_flag', align: 'left', width: 10, hidden:true},
                { name: 'remark', index: 'remark', align: 'left', width: 250, sortable : false,search: true, searchoptions: { sopt : [ 'cn', 'eq', 'ne' ] }, editable:true, editrules : {}}
            ],
            shrinkToFit: false,
            altRows: true,
            sortable : false,
            altclass: 'gridSpacingClass',
            forceFit: true,
            cellLayout: 0,
            scroll: false,
            sortname: 'sn',
            sortorder: "asc",
            loadonce: true,
            mtype: "POST",
            viewrecords: true,
            rownumbers: true,
            multiselect: true,
            rowNum: -1,
            pager : "#gridPager",
            jsonReader : {
                root : "rows",
                total : "total",
                page : "page",
                records : "records",
                repeatitems : false
            },
            pginput:false,
            pgbuttons:false,
            cellEdit: true,
            cellsubmit: 'clientArray',
            gridComplete : function() {
                $(".cbox").shiftSelect();
            },
            loadComplete : function(xhr) {
                setGridHeightWidth();
                FailResultDataToTip(xhr);
            },
            ondblClickRow : function(moduleid) {
                //showChildModule(moduleid);
            }
        });
        $('#gridTable').jqGrid('navGrid', '#gridPager',{
            add : false,
            edit : false,
            del : false,
            refresh : true
        }, {}, {}, {}, {
            multipleSearch : true,
            closeOnEscape : true,
            closeAfterSearch : true
        });
        $('#gridTable').jqGrid('navButtonAdd', '#gridPager', {
            caption : $.i18n.prop('TOGGLE_GRID_COLUMNS'),
            title : 'Set Columns',
            onClickButton : toggleGridColumns
        });
        $('#gridTable').jqGrid('navButtonAdd', '#gridPager', {
            caption : $.i18n.prop('TOGGLE_GRID_SEARCH_TOOLBAR'),
            title : 'Quick Search',
            onClickButton : toggleGridSearchToolbar
        });
        $('#gridTable').jqGrid('navButtonAdd', '#gridPager', {
            caption: $.i18n.prop('EXPORT_TO_EXCEL'),// 导出数据
            title: 'Export Datas',
            buttonicon: 'ui-icon-disk',
            onClickButton: function () {
                ExportToExcel.call(this, {
                    type: Global_BaseDataKey.EXPORT_TO_EXCEL_CURRENT
                });
            }
        });
        setGridHeightWidth();
    };

    //新增保费
    function addPremium() {
        var sheet_no =  $("#sheet_no").textbox("getValue");
        if (sheet_no=="") {
            errorNotification({SimpleMessage: "请先保存台账"});
            return;
		}
        var href = "../View/tzgl/Premium_month.html?sheet_no="+sheet_no;
        openDialog({ title: "月保费", id: 'Premium_month', width:550, height: 400, isResize: true, href: href, closable: true });
    }

    //删除保费
    function batchRrmovePremium() {
        var jsonList = [];
        var selectRowItems = $("#gridTable").jqGrid("getGridParam", "selarrrow");
        if (selectRowItems.length == 0) {
            errorNotification({
                SimpleMessage : $.i18n.prop("selectLeastOneDataRowOperator")
            });
            return;
        }

        for ( var i = 0; i < selectRowItems.length; i++) {
            var rowData = $("#gridTable").jqGrid('getRowData',selectRowItems[i]);
            if(rowData.premium_flag=='Y') {
                jsonList.push({id : rowData.id , sheet_no : rowData.sheet_no});
            } else {
                errorNotification({SimpleMessage: "只允许删除保费明细"});
                return;
            }
        }
        $.messager.confirm($.i18n.prop("prompt"),$.i18n.prop("deleteData"),
            function(r) {
                if (r) {
                    showLoading();
                    $.ajax({url : "../../tzgl/LedgerController/batchRrmovePremium?t="+ Math.random(),
                        type : "POST",
                        data : "jsonData=" + JSON.stringify(jsonList),
                        success : function(dataObj) {
                            if (isServerResultDataPass(dataObj)) {
                                correctNotification(dataObj.resultDataFull);
                                loadDetail({
                                    sheet_no : dataObj.resultDataFull.sheet_no,
                                    msg : { simpleMessage : dataObj.resultDataFull.msg }
                                });
                            } else {
                                FailResultDataToTip(dataObj);
                            }
                            hideLoading();
                        },
                        error : function(message) {
                            console.log(message);
                            hideLoading();
                        }
                    });
                }
            });
    }

    function refreshCallerData() {
        loadDetail();
    }

</script>
</body>
</html>
