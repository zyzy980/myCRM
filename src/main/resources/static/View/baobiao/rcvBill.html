<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="UTF-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"/>
    <link id="CustomTheme" type="text/css" rel="stylesheet" href="../../Resource/css/index/customLightBlue.css" />
    <link id="EasyuiTheme" type="text/css" rel="stylesheet" href="../../Resource/js/easyUI/themes/easyuiLightBlue.css" />    
    <link id="JqgridTheme" type="text/css" rel="stylesheet" href="../../Resource/js/jqueryUI/theme/jqgridLightBlue/jquery-ui-1.10.4.custom.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/easyUI/themes/icon.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/moment/css/daterangepicker.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/jqueryUI/theme/ui.jqgrid.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/fileUpload/css/fileUpload.css" />
    <title>#{thisPage}</title>
    <style type="text/css">
    .radioSpan {
	      position: relative;
	      border: 1px solid #95B8E7;
	      background-color: #fff;
	      vertical-align: middle;
	      display: inline-block;
	      overflow: hidden;
	      white-space: nowrap;
	      margin: 0;
	      padding: 0;
	      -moz-border-radius: 5px 5px 5px 5px;
	      -webkit-border-radius: 5px 5px 5px 5px;
	      border-radius: 5px 5px 5px 5px;
	      display:block;
	    }
    </style>
</head>
<body>
<div id="tabLocation" class="easyui-tabs">
	<div data-locale-title="title1" id="detailDiv1">
    <div id="toolbar" class="easyui-panel" style="padding: 4px; border-width: 0; border-bottom-width: 1px;">
         #{PAGE_TOOLBAR_BUTTONROLE}
    </div>
   <div class="searchParamesPanel">
        <table id="searchParamesTable">
        	<tr class="searchParamesTrShow">
        		<td class="searchParamesTdTitle">
         			&emsp;<label data-locale="CODE"/>:
                </td>
                <td class="searchParamesTdControl" >
               	 <input type="text" name="CODE" id="CODE" class="easyui-combobox"/>
                </td>
                <td class="searchParamesTdTitle">
                	&emsp;&emsp;<label data-locale="createDate"/>:
                </td>
	         	<td class="searchParamesTdControl">
	             	<input type="text" name="beginDate" id="beginDate" class="easyui-datebox" data-options="editable:false,onSelect:onChangeDate"/>
	         	</td>
	         	<td class="searchParamesTdTitle" style="text-align:center">-</td>
	         	<td class="searchParamesTdControl" >
	             	<input type="text" name="endDate" id="endDate" class="easyui-datebox" data-options="editable:false,onSelect:onChangeDate" />
	         	</td>
        	</tr>
        </table> 
    </div>
    <div id="gridControl">
        <table id="gridTable">
        </table>
        <div id="gridPager">
        </div>
    </div>
		   <div id="editData" class="easyui-dialog" style="padding:5px;width:400px;height:250px;" title="货币档案录入"  data-options="closed:true">
		<form id="addForm" class="easyui-form" method="post">
	    	<table class="editTable">
		         <tr>
		            <td class="editRequiredTitle" >
		                	<label data-locale="CODE"/>:
		            </td>
		            <td class="editControl">
		            	<input class="easyui-textbox" id="CODE1" name="CODE1" style="width: 157px;"/>
		           		<span style="color:red;font-size:16px;text-align:center;">*</span>
		            </td>
		        </tr>
		         <tr>
		            <td class="editRequiredTitle" >
		                	<label data-locale="TAX_RATE"/>:
		            </td>
		            <td class="editControl"> 
		            	<input class="easyui-textbox" id="TAX_RATE1" name="TAX_RATE1" style="width: 157px;"/>
		           		<span style="color:red;font-size:16px;text-align:center;">*</span>
		            </td>
		        </tr>
		        		         <tr>
		            <td class="editRequiredTitle" >
		                	<label data-locale="STATE"/>:
		            </td>
		            <td class="editControl">
		            	<input class="easyui-textbox" id="STATE1" name="STATE1" style="width: 157px;"/>
		           		<span style="color:red;font-size:16px;text-align:center;">*</span>
		            </td>
		        </tr>
		    </table>
		</form>
		<div id="dlg-buttons" style="margin-left:120px;margin-top:20px;">
			<a href="#" class="easyui-linkbutton" iconCls="icon-ok" onclick="javascript:ok()"><label data-locale="ok"/></a>&emsp;&emsp;
			<a href="#" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#editData').dialog('close')"><label data-locale="cancel"/></a>
		</div>
	</div>
	</div>
	<input type = "hidden" id = "sn1"/>
	<div data-locale-title="analysis" id="rcvBillCope">
		<iframe src="rcvBillCope.html" scrolling="auto" id="billAnalysis" name="billAnalysis"
				style="width: 100%;height: 500px;" frameborder="0"></iframe>
	</div>
</div>
</body>
<script type="text/javascript"	src="../../Resource/js/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="../../Resource/js/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="../../Resource/js/jquery.i18n.properties.js"></script>
<script type="text/javascript" src="../../Resource/js/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/jquery.easyuiExtend.min.js"></script>
<script type="text/javascript" src="../../Resource/js/base/commonControl.js"></script>
<script type="text/javascript" src="../../Resource/js/base/globalVariable.js"></script>
<script type="text/javascript" src="../../Resource/js/base/commonBusiness.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/i18n/grid.locale-cn.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/jquery.jqGrid.min.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/plugins/grid.setcolumns.js"></script>
<script type="text/javascript" src="../../Resource/js/fileUpload/js/upload.js"></script>
<script type="text/javascript" src="../../Resource/js/fileUpload/js/file.js"></script>
<script type="text/javascript" src="../../Resource/js/cookie/jquery.cookie.js"></script>
<script language="javascript" type="text/javascript">
    var lang = "zh";
    var nowDate = new Date();
    var fullYear = nowDate.getFullYear();
    var month = nowDate.getMonth() + 1; // getMonth 方法返回 0-11，代表1-12月
    var date = nowDate.getDate();

    $(function () {
        var parms = getUrlParms();
        moduleidAuthority = parms["moduleId"];
        lang = parms["lang"];
        loadList();
        hideLoading();
        
	    $.get('../../jcda/contractor/getC',{},function(data){
			
	      	$('#CODE').combobox({
	      		data:data,
	      		valueField:'code',
	      	    textField:'name',
	      	    onSelect:searchData
	      	}); 
	    });
	    
	    $("#beginDate").textbox("setValue", fullYear+"-"+month+"-01");
	    $("#endDate").textbox("setValue", fullYear+"-"+month+"-"+date);
    });
    
    
    //日期搜索
    function onChangeDate(){
    	var createDate = $("#beginDate").datebox('getValue');
    	var endDate = $("#endDate").datebox('getValue');
    	if(createDate>endDate){
    		$("#endDate").textbox("setValue", fullYear+"-"+month+"-"+date);
    	}
   		searchData();
   	}
    
    
    var oldSetGridHeightWidth = setGridHeightWidth;
    var setGridHeightWidth = function() {
    	oldSetGridHeightWidth(5, 188);
    }
    
	
    function searchData() {
        $("#gridTable").jqGrid('setGridParam', {
            url: getSearchGridUrl(),
            datatype: 'json',
            postData: getSearchFilters(),
            page: 1
        }).trigger("reloadGrid");
    }

    var getSearchGridUrl = function () {
        return '../../bill/manage/list1?t=' + Math.random();
    }
   
    var getSearchFilters = function () {
    	var beginDate = $("#beginDate").datebox('getText');
    	var endDate = $("#endDate").datebox('getText');
    	var CODE = $("#CODE").datebox('getText');
    	if(beginDate == "" || endDate == ""){
    	    $("#beginDate").textbox("setValue", fullYear+"-"+month+"-01");
    	}
    	if(endDate == null || endDate == ""){
    		$("#endDate").textbox("setValue", fullYear+"-"+month+"-"+date);
    	}
    	if(endDate !=null && endDate !=""){
    		endDate = addDate(endDate,1);
    	}
    	if(CODE == "" || CODE == "--所有--"){
    		CODE = null;
    	}
        var parmsArray =
        	 {'beginDate':beginDate,'endDate':endDate,'CODE':CODE};
        return parmsArray;
    }
    var loadList = function () {
    	 $("#gridTable").jqGrid({
             url: getSearchGridUrl(),
             datatype: "json",
             width: "none",
             colNames: [$.i18n.prop('CUS_NAME'),$.i18n.prop('YW_LOCATION'),$.i18n.prop('YW_DATE'),$.i18n.prop('SOURCE_YW_ID'),'{SOURCE_CUS_YWID}',
                        $.i18n.prop('FEE_NAME'),$.i18n.prop('AMOUNT'),$.i18n.prop('RCV_AMT'),$.i18n.prop('REMARK')],
             colModel: [
            	{ name: 'cus_NAME', index: 'cus_NAME', lign: 'center', search: true, sortable: false, width: 140 },
 				{ name: 'yw_LOCATION', index: 'yw_LOCATION', align: 'center', search: true, sortable: false, width: 140 },
 				{ name: 'yw_DATE', index: 'yw_DATE', align: 'center', search: true, sortable: false, width: 140 },
 				{ name: 'source_YW_ID', index: 'source_YW_ID', align: 'center', search: true, sortable: false, width: 140 },
 				{ name: 'source_CUS_YWID', index: 'source_CUS_YWID', align: 'center', search: true, sortable: false, width: 140 },
 				{ name: 'fee_NAME', index: 'fee_NAME', align: 'center', search: true, sortable: false, width: 140 },
 				{ name: 'amount', index: 'amount', align: 'center', search: true, sortable: false, width: 140 },
 				{ name: 'rcv_AMT', index: 'rcv_AMT',  align: 'center', search: true, sortable: false, width: 140 },
 				{ name: 'remark"', index: 'remark"',  align: 'center', search: true, sortable: false, width: 140}
             ],
/*              ,formatter: function (value, grid, row){
					if(row.state==0){
						return '正常';
					}
					if(row.state == 1){
						return '注销';
					}
					if(row.state = 2){
						return '审核';
					}
				} } */
             datatype:'json', 
             postData:getSearchFilters(),
             shrinkToFit: false,
             altRows: true,
             altclass: 'gridSpacingClass',
             forceFit: true,
             cellLayout: 0,
             scroll: false,
             autowidth: true,
             sortname: 'createDate',
             sortorder: "desc", 
             loadonce: false,
             mtype: "GET",
             footerrow:true,
             viewrecords: true,
             rownumbers: true,
             //multiselect: true,
             rowNum: 15,
             height: "100%",
             rowList: [15, 20, 30, 50],
             pager: "#gridPager",
             jsonReader: {
                 root: "rows",
                 total: "total",
                 page: "page",
                 records: "records",
                 repeatitems: false
             },
             gridComplete: function () {
                 $(".cbox").shiftSelect();
                 var sumAmount = 0;
                 var sumAmountReceived = 0;
                 if(isNaN(parseInt($("#gridTable").getCol('amount',false,'sum')))) {
                     sumAmount += 0;
                 } else {
                     sumAmount = $("#gridTable").getCol('amount',false,'sum');
                 }
                 if(isNaN(parseInt($("#gridTable").getCol('rcv_AMT',false,'sum')))) {Login2
                     sumAmountReceived += 0;
                 } else {
                     sumAmountReceived = $("#gridTable").getCol('rcv_AMT',false,'sum');
                 }
                 $("#gridTable").footerData('set', { "yw_LOCATION" : '合计', amount: '<span style="font-size:22px;color:red">'+sumAmount+'</span>'});
                 $("#gridTable").footerData('set', { "yw_LOCATION" : '合计', rcv_AMT: '<span style="font-size:22px;color:red">'+sumAmountReceived+'</span>'});
                 $(".cbox").shiftSelect();
             },
             ondblClickRow: function (code) {
 				showTable(code);
             },
             loadComplete: function (xhr) {
                 
             }
         });

          $("#gridTable").jqGrid('navGrid', '#gridPager', { add: false, edit: false, del: false, refresh: true }, {}, {}, {}, { multipleSearch: true, closeOnEscape: true, closeAfterSearch: true });
         $("#gridTable").jqGrid('navButtonAdd', '#gridPager', {
             caption: "设置列",
             title: $.i18n.prop('costPlan.grid.control.setColumn'),
             onClickButton: toggleGridColumns
         });

         $("#gridTable").jqGrid('navButtonAdd', '#gridPager', {
             caption: "快捷搜索",
             title: $.i18n.prop('costPlan.grid.control.quickSearch'),
             onClickButton: toggleGridSearchToolbar
         });
         setGridHeightWidth();
    }
    
    
    // 日期，在原有日期基础上，增加days天数，默认增加1天
    function addDate(date, days) {
        if (days == undefined || days == '') {
            days = 1;
        }
        var date = new Date(date);
        date.setDate(date.getDate() + days);
        var month = date.getMonth() + 1;
        var day = date.getDate();
        return date.getFullYear() + '-' + getFormatDate(month) + '-' + getFormatDate(day);
    }

    // 日期月份/天的显示，如果是1位数，则在前面加上'0'
    function getFormatDate(arg) {
        if (arg == undefined || arg == '') {
            return '';
        }

        var re = arg + '';
        if (re.length < 2) {
            re = '0' + re;
        }

        return re;
    }
    
    
    function onread(){
    	searchData();
    }
    
    function cleanInput(){
    	 $("#sn1").val("");
		 $("#curName1").textbox("setValue", "");
		 $("#curCode1").textbox("setValue", "");
    }
    
    function exportPdf(){
    	$.get("../..//bill/manage/getPdf1",getSearchFilters(),function(data){
    		window.open(data);
    	})
    }
    
    function reload(){
    	searchData();
    }
    
</script>
</html>
