<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <!--<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link id="CustomTheme" type="text/css" rel="stylesheet"
          href="../../Resource/css/index/customLightBlue.css" />
    <link id="EasyuiTheme" type="text/css" rel="stylesheet"
          href="../../Resource/js/easyUI/themes/easyuiLightBlue.css" />
    <link id="JqgridTheme" type="text/css" rel="stylesheet"
          href="../../Resource/js/jqueryUI/theme/jqgridLightBlue/jquery-ui-1.10.4.custom.css" />
    <link type="text/css" rel="stylesheet"
          href="../../Resource/js/easyUI/themes/icon.css" />
    <link type="text/css" rel="stylesheet"
          href="../../Resource/js/jqueryUI/theme/ui.jqgrid.css" />-->
    <link type="text/css" rel="stylesheet" href="../../Resource/css/index/customGreen.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/easyUI/themes/easyuiGreen.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/easyUI/themes/icon.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/locationsChoose/css.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/css/index/customLightBlue.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/easyUI/themes/easyuiLightBlue.css" />
    <link type="text/css" rel="stylesheet"
        href="../../Resource/js/jqueryUI/theme/jqgridLightBlue/jquery-ui-1.10.4.custom.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/moment/css/daterangepicker.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/jqueryUI/theme/ui.jqgrid.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/fileUpload/css/fileUpload.css" />


    <link id="CustomTheme" type="text/css" rel="stylesheet" href="../../Resource/css/index/customLightBlue.css" />
    <link id="EasyuiTheme" type="text/css" rel="stylesheet"
        href="../../Resource/js/easyUI/themes/easyuiLightBlue.css" />
    <link id="JqgridTheme" type="text/css" rel="stylesheet"
        href="../../Resource/js/jqueryUI/theme/jqgridLightBlue/jquery-ui-1.10.4.custom.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/easyUI/themes/icon.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/jqueryUI/theme/ui.jqgrid.css" />
    <link type="text/css" rel="stylesheet" href="../../Resource/js/fileUpload/css/fileUpload.css" />
    <style type="text/css">
        /*.splitBox{display: table;width: 100%;height:20px;}
		.splitBox .splitTitle{display: table-cell;cursor:pointer; text-align:center;width:15%;font-size: 12px;font-weight: bold; color:#fff; background-color:#C2D3E9; vertical-align: middle;}
		.splitBox .splitHr{display: table-cell;text-align: left;vertical-align: middle;}
		.splitBox .splitHr hr{height: 1px;border: none;border-top: 1px dotted #3eafe0;margin-top: 2px; margin-bottom: 2px;}
		.splitBox .splitRemark{display: table-cell;font-size: 12px;color: #3eafe0; text-align: right; width: 130px; vertical-align: middle; font-weight:bold;}
		.editTable table input{width:auto;}
		.button-groups {
			position: absolute;
			bottom: 0px;
			right: 20px;
			font-size: 12px;
			padding: 10px;
		}
		.button-groups .button {
			height: 28px;
			line-height: 28px;
			background-color: #0D9BF2;
			color: #FFF;
			border: 0;
			outline: none;
			padding-left: 5px;
			padding-right: 5px;
			border-radius: 3px;
			margin-bottom: 4px;
			cursor: pointer;
		}
		#address {
			margin-left: 0px;
			margin-right: 0px;
			padding-top: 2px;
			padding-bottom: 2px;
			width: 143px;
			font-size: 12px;
			color: #aaa;
			margin: 0;
			padding: 4px;
			white-space: normal;
			vertical-align: top;
			outline-style: none;
			resize: none;
			border-radius: 0px 0px 0px 0px;
			-webkit-appearance: textfield;
			background-color: white;
			-webkit-rtl-ordering: logical;
			cursor: text;
			letter-spacing: normal;
			word-spacing: normal;
			text-transform: none;
			text-indent: 0px;
			text-shadow: none;
			display: inline-block;
			text-align: start;
			text-rendering: auto;
			font: 400 13.3333px Arial;
			position: relative;
			border: 1px solid #C2D3E9;
			background-color: #fff;
			vertical-align: middle;
			display: inline-block;
			overflow: hidden;
			margin: 0;
			padding: 0;
		}

		.input-card {
			display: flex;
			flex-direction: column;
			min-width: 0;
			word-wrap: break-word;
			background-color: #fff;
			background-clip: border-box;
			border-radius: .25rem;
			width: 22rem;
			border-width: 0;
			border-radius: 0.4rem;
			box-shadow: 0 2px 6px 0 rgba(114, 124, 245, .5);
			position: fixed;
			bottom: 4rem;
			right: 1rem;
			-ms-flex: 1 1 auto;
			flex: 1 1 auto;
			padding: 0.4rem 1.25rem;
		}*/


        .button-group {
            position: absolute;
            right: 20px;
            font-size: 12px;
            top: 355px;
        }

        /*  .editTable input[readonly="readonly"] {
              background-color: #ffffff;
          }*/


        label {
            /*   display: inline-block; */
            /*   margin-bottom: 0.4rem; */
        }

        /* label, .btn {
          margin-left: 0;
          font-size: 1rem;
        } */


        input[type=checkbox],
        input[type=radio] {
            box-sizing: border-box;
            padding: 0;
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            padding: 0;
            margin: 0 0.5rem 0 0;
        }

        h4 {
            font-family: inherit;
            line-height: 1.8;
            font-weight: 300;
            color: inherit;
            font-size: 1.1rem;
            margin-top: 0;
            margin-bottom: .5rem
        }

        .btn {
            display: inline-block;
            font-weight: 400;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            border: 1px solid transparent;
            transition: color .15s ease-in-out, background-color .15s ease-in-out, border-color .15s ease-in-out, box-shadow .15s ease-in-out;
            background-color: transparent;
            background-image: none;
            color: #25A5F7;
            border-color: #25A5F7;
            padding: .25rem .5rem;
            line-height: 1.5;
            border-radius: 1rem;
            -webkit-appearance: button;
            cursor: pointer;
        }

        .btn:hover {
            color: #fff;
            background-color: #25A5F7;
            border-color: #25A5F7
        }

        .btn:hover {
            text-decoration: none
        }


        .input-item-text input[type=checkbox],
        .input-item-text input[type=radio] {
            margin-top: 0
        }

        .input-card {
            display: flex;
            flex-direction: column;
            min-width: 0;
            word-wrap: break-word;
            background-color: #fff;
            background-clip: border-box;
            border-radius: .25rem;
            width: 22rem;
            border-width: 0;
            border-radius: 0.4rem;
            box-shadow: 0 2px 6px 0 rgba(114, 124, 245, .5);
            position: fixed;
            bottom: 4rem;
            right: 1rem;
            -ms-flex: 1 1 auto;
            flex: 1 1 auto;
            padding: 0.4rem 1.25rem;
        }



        .info hr {
            margin-right: 0;
            margin-left: 0;
            border-top-color: grey;
        }

        .info {
            padding: .75rem 1.25rem;
            margin-bottom: 1rem;
            border-radius: .25rem;
            position: fixed;
            top: 1rem;
            background-color: white;
            width: auto;
            min-width: 22rem;
            border-width: 0;
            right: 1rem;
            box-shadow: 0 2px 6px 0 rgba(114, 124, 245, .5);
        }

        .code {
            left: 1.5rem;
            right: 1.5rem;
            top: 1.5rem;
            bottom: 1.5rem;
            overflow: auto;
            margin-bottom: 0rem;
        }

        .code .btn {
            top: 1rem;
            position: absolute;
            right: 1rem;
        }

        .code .result {
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 0.5rem;
            padding: 1rem;
            bottom: 1rem;
            position: absolute;
            top: 5.5rem;
            right: 1rem;
            left: 1rem;
            overflow: auto;
        }

        .code .status {
            color: #80adff;
            display: inline-block;
            font-size: 14px;
        }

        .code h4 {
            display: inline-block;
            max-width: 20rem;
            margin-right: 1rem;
            margin-bottom: 1rem;
        }


        select:focus,
        input[type=text]:focus,
        input[type=date]:focus {
            border-color: #80bdff;
            outline: 0;
            box-shadow: 0 0 0 .1rem rgba(128, 189, 255, .1)
        }

        .btn:focus {
            outline: 0;
            box-shadow: none;
        }

        select:focus::-ms-value,
        input[type=text]:focus::-ms-value,
        input[type=date]:focus::-ms-value {
            color: #495057;
            background-color: #fff
        }


        /* native toastr */
        .native-toast {
            position: fixed;
            background-color: rgba(50, 50, 50, .8);
            border-radius: 33px;
            color: white;
            left: 50%;
            text-align: center;
            padding: 6px 12px;
            opacity: 0;
            z-index: 99999;
            transition: transform .25s, opacity .25s, top .25s;
            box-sizing: border-box;
        }

        .native-toast-bottom {
            bottom: 50px;
            -ms-transform: translateX(-50%) translateY(50px);
            transform: translateX(-50%) translateY(50px)
        }

        .native-toast-bottom.native-toast-shown {
            opacity: 1;
            -ms-transform: translateX(-50%) translateY(0);
            transform: translateX(-50%) translateY(0);
        }

        .native-toast-bottom.native-toast-edge {
            bottom: 0;
        }

        .native-toast-top {
            top: 50px;
            -ms-transform: translateX(-50%) translateY(-50px);
            transform: translateX(-50%) translateY(-50px)
        }

        .native-toast-top.native-toast-shown {
            opacity: 1;
            -ms-transform: translateX(-50%) translateY(0);
            transform: translateX(-50%) translateY(0);
        }

        .native-toast-top.native-toast-edge {
            top: 0;
        }

        .native-toast-center {
            top: 0;
            -ms-transform: translateX(-50%) translateY(-50px);
            transform: translateX(-50%) translateY(-50px)
        }

        .native-toast-center.native-toast-shown {
            opacity: 1;
            top: 50%;
            -ms-transform: translateX(-50%) translateY(-50%);
            transform: translateX(-50%) translateY(-50%);
        }

        .native-toast-edge {
            border-radius: 0;
            width: 100%;
            text-align: left;
        }

        @media screen and (min-width: 40rem) {
            .native-toast:not(.native-toast-edge) {
                max-width: 18rem;
            }
        }


        .native-toast-error {
            background-color: #d92727;
            color: white;
        }

        .native-toast-success {
            background-color: #62a465;
            color: white;
        }

        .native-toast-warning {
            background-color: #fdaf17;
            color: white;
        }

        .native-toast-info {
            background-color: #5060ba;
            color: white;
        }

        [class^="native-toast-icon-"] {
            vertical-align: middle;
            margin-right: 8px
        }

        [class^="native-toast-icon-"] svg {
            width: 16px;
            height: 16px;
        }

        .item2 {
            background: url(../images/icon3.png) 18px 8px no-repeat;
        }

        a {
            text-decoration: none;
            cursor: pointer;
        }
    </style>
    <title>#{zdCus.detail.thisPage}</title>
</head>

<body style="overflow:hidden">
    <div id="toolbar" class="easyui-panel" style="padding: 4px; border-width:0; border-bottom-width:1px;">
        #{PAGE_TOOLBAR_BUTTONROLE}
    </div>

    <form id="addForm" class="easyui-form" style="height: 600px;" method="post" data-options="novalidate:true">
        <input type="hidden" id="sn" name="sn" />
        <input type="hidden" name="fence" id="fence" />
        <div id="tabLocation" class="easyui-tabs" data-options="tabPosition:'top',fit:true,headerWidth:80,tabWidth:80">
            <div data-locale-title="addressDetail_baseInfo" style="padding: 10px">
                <table class="editTable">
                    <tr>
                        <td class="editTitle">
                            <label data-locale="addressDetail_addressCode"/>:
                        </td>
                        <td class="editControl">
                            <input class="easyui-textbox" name="addressCode" id="addressCode"
                                data-locale-missingmessage="please choose"
                                data-options="required:false,validType:'addressCode'" />
                        </td>
                        <td class="editTitle"><label data-locale="addressDetail_addressName"/>:
                        </td>
                        <td class="editControl">
                            <input type="text" name="name" id="name"
                                data-locale-missingmessage="addressDetail_addressNameCannotBeEmpty" data-options="required:true"
                                class="easyui-textbox" />
                        </td>
                    </tr>

                    <!--<tr>
                    <td class="editTitle">
                        地址:
                    </td>
                    <td class="editControl">
                        <input class="" name="address" autocomplete="off" id="address" style="height: 20px;width: 150px;"/>
                        &nbsp&nbsp地址详情:&nbsp<input class="easyui-textbox" name="addressDetail" id="addressDetail" style="width: 180px;"/>
                    </td>
                    <td class="editTitle">
                        省/市/区:
                    </td>
                    <td class="editControl">
                        <input id='beginDistrict' name="beginDistrict" class='easyui-combobox' data-options="panelWidth:'180'" style='width:100px'/>
                        <input id='beginCity' name="beginCity" class='easyui-combobox' data-options="panelWidth:'180'" style='width:100px'/>
                        <input id='beginArea' name="beginArea" class='easyui-combobox' data-options="panelWidth:'180'" style='width:100px'/>
                    </td>
                </tr>-->
                    <tr>
                        <td class="editRequiredTitle"><label data-locale="addressDetail_addressDetail"/>:
                        </td>
                        <td class="editControl">
                            <span class="textbox" style="width: 152px; height: 20px; color:#484848; float: left">
                                <input type="text" class="textbox-text textbox-prompt" autocomplete="off" id="address"
                                    name="address" style="margin-left: 0px; margin-right: 0px; padding-top: 3px;
                                padding-bottom: 3px; color:#000000;" />
                            </span>
                            <!-- <div  style="float:left;margin-left: 10px;">
                             <a id="images" href="javascript:img();" >
                                 <img src="../../Resource/images/left/33.png" style="width:20px;" ></img>
                             </a>
                         </div>-->
                        </td>

                        <td class="editTitle">
                            #{addressDetail_Province/city/district}:
                        </td>
                        <td class="editControl">
                            <input id='beginDistrict' name="beginDistrict" class='easyui-combobox'
                                data-options="panelWidth:'180'" style='width:120px' />
                            <input id='beginCity' name="beginCity" class='easyui-combobox'
                                data-options="panelWidth:'180'" style='width:120px' />
                            <input id='beginArea' name="beginArea" class='easyui-combobox'
                                data-options="panelWidth:'180'" style='width:120px' />
                        </td>

                    <tr>


                        <!--<td class="editTitle">
                        业务地点:
                    </td>
                    <td class="editControl">
                        <input class="easyui-combobox" name="ywLocation" id="ywLocation" style="width: 153px;"
                        data-locale-missingmessage="please choose" data-options="required:true,valueField:'id',textField:'text'"/>
                    </td>-->
                    </tr>
                    <tr>
                        <td class="editTitle">
                            <label data-locale="addressDetail_linkMan"/>:
                        </td>
                        <td class="editControl">
                            <input class="easyui-textbox" name="linkman" id="linkman"
                                data-locale-missingmessage="addressDetail_linkManCannotBeEmpty" data-options="required:true" />
                        </td>
                        <td class="editTitle">
                            <label data-locale="addressDetail_linkTel"/>:
                        </td>
                        <td class="editControl">
                            <input class="easyui-textbox" name="linktel" id="linktel"
                                data-locale-missingmessage="addressDetail_contractNumberCannotBeEmpty"
                                data-options="required:true,validType:'telNum'" />
                        </td>
                    </tr>
                    <tr>
                        <td class="editTitle">
                            <label data-locale="addressDetail_cusName"/>:
                        </td>
                        <td cladd="editControl">
                            <input class="easyui-combobox" name="cusId" id="cusId" style="width: 153px;"
                                data-locale-missingmessage="please choose"
                                data-options="required:true,valueField:'id',textField:'text',panelWidth:'300'" />
                        </td>
                        <td class="editTitle"><label data-locale="addressDetail_addressKind"/>:
                        </td>
                        <td class="editControl">
                            <input type="text" name="kind" id="kind" class="easyui-combobox" />
                        </td>


                    </tr>
                    <tr>
                        <td class="editTitle" style="color:#484848;display: none">lo:
                        </td>
                        <td class="editControl" style="display: none">
                            <input type="text" id="lo" name="lo" class="easyui-textbox" />
                        </td>
                        <td class="editTitle" style="color:#484848;display: none">la:
                        </td>
                        <td class="editControl" style="display: none">
                            <input type="text" name="la" id="la" class="easyui-textbox" />
                        </td>
                    </tr>

                    <tr>
                        <td class="editTitle"><label data-locale="begin_arrive_trigger_event"/>:</td>
                        <td class="editControl">
                            <input type="text" name="begin_arrive_trigger_event" id="begin_arrive_trigger_event"
                                class="easyui-combobox" />
                        </td>
                        <td class="editTitle"><label data-locale="end_arrive_trigger_event"/>:</td>
                        <td class="editControl">
                            <input type="text" name="end_arrive_trigger_event" id="end_arrive_trigger_event"
                                class="easyui-combobox" />
                        </td>
                    </tr>

                    <tr>
                        <td class="editTitle"><label data-locale="begin_arrive_trigger_state"/>:</td>
                        <td class="editControl">
                            <input type="text" name="begin_arrive_trigger_state" id="begin_arrive_trigger_state"
                                class="easyui-combobox" />
                        </td>
                        <td class="editTitle"><label data-locale="end_arrive_trigger_state"/>:</td>
                        <td class="editControl">
                            <input type="text" name="end_arrive_trigger_state" id="end_arrive_trigger_state"
                                class="easyui-combobox" />
                        </td>
                    </tr>

                    <tr>
                        <td class="editTitle">
                            <label data-locale="addressDetail_acceptPointOfOrigin"/>:
                        </td>
                        <td class="editControl" colspan="10">
                            <div id="divsf_kind">
                            </div>
                        </td>
                    </tr>

                </table>
            </div>
            <div data-locale-title="addressDetail_electronicFence" style="position: absolute;">
                <div>
                    <div id="container"></div>
                    <div class="input-card" style="width: 50px; height: 20px;">
                        <a href="javascript:Sjtb();" class="item">
                            <p
                                style="margin: 0px; line-height: 20px; text-align: center; color: #0D9BF2; background: url(../images/icon3.png) 18px 8px no-repeat; text-decoration: underline;">
                                <label data-locale="addressDetail_deleteFence"/></p>
                        </a>
                    </div>
                    <div id="toolbarMap" class="BMapLib_Drawing BMap_noprint anchorTR"
                        style="transform: scale(0.8); margin-left: -39px; margin-top: -5px; position: absolute; z-index: 10; text-size-adjust: none; bottom: auto; right: 5px; top: 5px; left: auto;">
                        <div class="BMapLib_Drawing_panel">
                            <a class="BMapLib_box BMapLib_hander_hover" drawingtype="1" href="javascript:void(0)"
                                data-locale-title="addressDetail_dragTheMap" onclick="select(this)" id="initbtn"></a>
                            <a class="BMapLib_box BMapLib_circle" drawingtype="0" href="javascript:void(0)"
                                data-locale-title="addressDetail_aCircle" onclick="select(this)" id="circle"></a>
                            <a class="BMapLib_box BMapLib_polygon" drawingtype="0" href="javascript:void(0)"
                                data-locale-title="addressDetail_polygon" onclick="select(this)" id="polygon"></a>
                            <a class="BMapLib_box BMapLib_rectangle BMapLib_last" drawingtype="0"
                                href="javascript:void(0)" data-locale-title="addressDetail_rectangular" onclick="select(this)"
                                id="rectangle"></a>
                        </div>
                    </div>
                    <div class="button-group">
                        <input id="en" type="button" class="button" data-locale-value="addressDetail_englishBaseMap" />
                        <input id="zh_en" type="button" class="button" data-locale-value="addressDetail_displayBaseMap" />
                        <input id="zh_cn" type="button" class="button" data-locale-value="addressDetail_displayChinese" />
                    </div>
                </div>
            </div>

        </div>
    </form>
</body>
<!--<script type="text/javascript" src="../../Resource/js/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="../../Resource/js/jquery.i18n.properties.js"></script>
<script type="text/javascript" src="../../Resource/js/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/jquery.easyuiExtend.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="../../Resource/js/base/commonControl.js"></script>
<script type="text/javascript" src="../../Resource/js/base/globalVariable.js"></script>
<script type="text/javascript" src="../../Resource/js/base/commonBusiness.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/i18n/grid.locale-cn.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/jquery.jqGrid.min.js"></script>
<script type="text/javascript" src="../../Resource/js/My97DatePicker/WdatePicker.js"></script>
<script type="text/javascript" src="../../Resource/js/jqueryUI/plugins/grid.setcolumns.js"></script>
<script type="text/javascript" src="../../Resource/js/regex/regex.js"></script>
&lt;!&ndash;<script type="text/javascript" src="../../View/ywgl/API/AMap/js/maps.js"></script>&ndash;&gt;
<script type="text/javascript" src="../../Resource/js/locationsChoose/locations.js?s=0.181206002"></script>

<script type="text/javascript" src="../../Resource/js/cookie/jquery.cookie.js"></script>-->
<!--<script src="https://webapi.amap.com/maps?v=1.3&key=7defcebd378d7fcd05dbcb9298d20d2e&plugin=AMap.PolyEditor,AMap.Geocoder,AMap.CircleEditor,AMap.RectangleEditor,AMap.MouseTool,AMap.ToolBar,AMap.DistrictSearch"></script>

<script type="text/javascript" src="https://webapi.amap.com/demos/js/liteToolbar.js"></script>-->

<script type="text/javascript" src="../../Resource/js/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="../../Resource/js/jquery-migrate-1.2.1.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/jquery.easyuiExtend.min.js"></script>
<script type="text/javascript" src="../../Resource/js/easyUI/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="../../Resource/js/base/commonControl.js"></script>
<script type="text/javascript" src="../../Resource/js/base/globalVariable.js"></script>
<script type="text/javascript" src="../../Resource/js/base/commonBusiness.js"></script>
<script type="text/javascript" src="../../Resource/js/jsLinq/linq.js"></script>
<script type="text/javascript" src="../../Resource/js/locationsChoose/locations.js"></script>
<script type="text/javascript" src="../../Resource/js/cookie/jquery.cookie.js"></script>



<script language="javascript" type="text/javascript">
    var sn = "";
    var pleaseChoose = $.i18n.prop('addressDetail_pleaseChoose');
    var result;
    var afterSave = "close";
    var callerId = ""
    var callerType = "";
    var callbackFlag = "";



    var p = "";
    var c = "";
    var lnglatXY = [];
    var lo1 = "";
    var la1 = "";
    var address = "";
    var lo = "";
    var la = "";
    var map = "";
    var code = "";
    var cusid = "";
    var siteArray = "";
    var globalcusArray = "";
    var globalStateArray = null; // 全局状态变量
    var globalKindArray = null; // 分类
    var originalFormData = "";
    var objArrayJson = "";
    var editor = {};
    var addressname = "";
    var userlevel = "";
    var marker;
    var one;

    $(function () {
        var parms = getUrlParms();
        sn = parms["sn"];
        lo = parms["lo"];
        la = parms["la"];
        address = parms["address"];

        callerId = parms["callerId"];
        callerType = parms["callerType"];
        callbackFlag = parms["callbackFlag"];
        /*loadYwLocation();*/
        initScript();

        searchCus();
        initData();
        stateCheck();//事件类别
        /*tipinput("address", $("#addressDetail"));*/

        //运单状态明细
        getDictionaryData({
            dicTypeCode: Global_DicType.Global_DicType_sheet_yw_order_detail_state,
            async: false,
            callback: function (callbackData) {
                initTrigger_stateControl(callbackData);
            }
        });

        $("#addressCode").textbox('textbox').focus();
    });

    var initScript = function () {
        setPlaceHolder();
    }
    var setPlaceHolder = function () {
        $("#addressCode").closest("td").find("input").attr("placeholder", $.i18n.prop('addressDetail_addressCodeTip')).attr("maxlength", "13")
    }

    //事件类别
    function stateCheck() {
        stateCheckSelect = [{ Value: "", Text: "--#{all}--" }];
        stateCheckSelect.push({ Value: $.i18n.prop('null'), Text: $.i18n.prop('null') });
        stateCheckSelect.push({ Value: $.i18n.prop('trigger'), Text: $.i18n.prop('trigger') });
        stateCheckSelect.push({ Value: $.i18n.prop('inform'), Text: $.i18n.prop('inform') });
        /*stateCheckSelect.push({Value:"B",Text:"校验状态"});
        stateCheckSelect.push({Value:"C",Text:"触发状态"});*/
        $("#begin_arrive_trigger_event").combobox({
            data: stateCheckSelect,
            valueField: 'Value',
            textField: 'Text',
            panelHeight: 100,
            editable: false
        });
        $("#begin_arrive_trigger_event").combobox('setValue', "");
        $("#end_arrive_trigger_event").combobox({
            data: stateCheckSelect,
            valueField: 'Value',
            textField: 'Text',
            panelHeight: 100,
            editable: false
        });
        $("#end_arrive_trigger_event").combobox('setValue', "");
    }

    var initTrigger_stateControl = function (jsonData) {
        one = [{ Value: "", Text: "--#{all}--" }];
        one = jsonData;
        $('#begin_arrive_trigger_state').combobox({
            data: $('#begin_arrive_trigger_event').combobox('getValue') == $.i18n.prop('null') ? one : [({ dicValue: "", dicText: "--#{all}--" })],
            valueField: 'dicValue',
            textField: 'dicText',
            panelHeight: 150,
            editable: false,
        });
        $("#begin_arrive_trigger_state").combobox('setValue', "")

        $('#end_arrive_trigger_state').combobox({
            data: $('#end_arrive_trigger_event').combobox('getValue') == $.i18n.prop('null') ? one : [({ dicValue: "", dicText: "--#{all}--" })],
            valueField: 'dicValue',
            textField: 'dicText',
            panelHeight: 150,
            editable: false,
        });
        $("#end_arrive_trigger_state").combobox('setValue', "")
    }

    $("#begin_arrive_trigger_event").combobox({
        onChange: function (n, o) {
            if (n == $.i18n.prop('null')) {
                $("#begin_arrive_trigger_state").combobox({
                    data: [{ dicValue: "", dicText: "--#{all}--" }],
                    valueField: 'dicValue',
                    textField: 'dicText',
                    panelHeight: 100,
                    editable: false,
                    disabled: false
                });
            } else if (n == "") {
                $("#begin_arrive_trigger_state").combobox({
                    data: [{ dicValue: "", dicText: "--#{all}--" }],
                    valueField: 'dicValue',
                    textField: 'dicText',
                    panelHeight: 100,
                    editable: false,
                    disabled: false
                });
            } else if (n == $.i18n.prop('inform')) {
                $("#begin_arrive_trigger_state").combobox({
                    data: [{ dicValue: "", dicText: "--#{all}--" }],
                    valueField: 'dicValue',
                    textField: 'dicText',
                    panelHeight: 100,
                    editable: false,
                    disabled: true
                });
            } else {
                $("#begin_arrive_trigger_state").combobox({
                    data: one,
                    valueField: 'dicValue',
                    textField: 'dicText',
                    panelHeight: 100,
                    editable: false,
                    disabled: false
                });
            }
        }
    });

    $("#end_arrive_trigger_event").combobox({
        onChange: function (n, o) {
            if (n == $.i18n.prop('null')) {
                $("#end_arrive_trigger_state").combobox({
                    data: [{ dicValue: "", dicText: "--#{all}--" }],
                    valueField: 'dicValue',
                    textField: 'dicText',
                    panelHeight: 100,
                    editable: false,
                    disabled: false
                });
            } else if (n == "") {
                $("#end_arrive_trigger_state").combobox({
                    data: [{ dicValue: "", dicText: "--#{all}--" }],
                    valueField: 'dicValue',
                    textField: 'dicText',
                    panelHeight: 100,
                    editable: false,
                    disabled: false
                });
            } else if (n == $.i18n.prop('inform')) {
                $("#end_arrive_trigger_state").combobox({
                    data: [{ dicValue: "", dicText: "--#{all}--" }],
                    valueField: 'dicValue',
                    textField: 'dicText',
                    panelHeight: 100,
                    editable: false,
                    disabled: true
                });
            } else {
                $("#end_arrive_trigger_state").combobox({
                    data: one,
                    valueField: 'dicValue',
                    textField: 'dicText',
                    panelHeight: 100,
                    editable: false,
                    disabled: false
                });
            }
        }
    });

    $("#begin_local_name").combobox({
        onChange: function (n, o) {
            $("#begin_local").val($("#begin_local_name").combobox('getValue').split("&")[0]);
            $("#begin_fence").val($("#begin_local_name").combobox('getValue').split("&")[1]);
            /* if (sn=="") {
                 $('#route_name').textbox("setValue",$("#begin_local").val()+'_'+$("#end_local").val());
                 $('#route_code').textbox("setValue",$("#begin_local").val()+'_'+$("#end_local").val());
             }*/
        }
    });
    $("#end_local_name").combobox({
        onChange: function (n, o) {
            $("#end_local").val($("#end_local_name").combobox('getValue').split("&")[0]);
            $("#end_fence").val($("#end_local_name").combobox('getValue').split("&")[1]);
            /*if (sn=="") {
                $('#route_name').textbox("setValue",$("#begin_local").val()+'_'+$("#end_local").val());
                $('#route_code').textbox("setValue",$("#begin_local").val()+'_'+$("#end_local").val());
            }*/
        }
    });


    $(window).load(function () {
        hideLoading();
    });

    var initData = function () {
        readProvince();
        loadKind();
        var jsonData = [{ dicText: $.i18n.prop('addressDetail_delivery'), dicValue: "1" },
        { dicText: $.i18n.prop('addressDetail_goods'), dicValue: "2" },
        { dicText: $.i18n.prop('addressDetail_consigneeOfConfignor'), dicValue: "3" },
        ]
        initKindControl(jsonData)
        if (sn != '' && sn != undefined) {
            $("input", $("#addressCode").next("span")).attr("readonly", "readonly");
            $("#sn").val(sn);
            $("input", $("#name").next("span")).attr("readonly", "readonly");
            loadDetail();
        }
        validate();
    }

    var loadKind = function () {
        $("#kind").combobox({
            valueField: "code",
            textField: "name",
            panelHeight: 80,
            editable: false,
            loader: function (param, success, error) {
                $.ajax({
                    url: "../../jcda/ZdCus/queryDictionary?t=" + Math.random() + "&kind=locationType",
                    method: "GET",
                    async: true,
                    dataType: 'json',
                    success: function (dataObj) {
                        let data = dataObj.resultDataFull;
                        var supArr = [];
                        supArr.unshift({ code: '', name: "--#{addressDetail_all}--" });
                        data.forEach(function (item) {
                            supArr.push({ code: item.dicValue, name: item.dicText });
                        });
                        success(supArr);
                        $("#kind").combobox("setValue", "--#{addressDetail_all}--");
                    }
                });
            }
        });
    }

    var initKindControl = function (jsonData) {
        var formatData = { data: jsonData, needChooseAll: false, chooseAllValue: "", defaultValue: "", bindBoxName: "divsf_kind", bindControlPrefix: "rdbsf_kind" };
        formatDefaultCheckbox_Local(formatData);
    }



    /*var initKindControl = function(jsonData) {
        jsonData.unshift({
            dicValue : "",
            dicText : "--#{addressDetail_all}--"
        });
        $('#kind').combobox({
            data : jsonData,
            valueField : 'dicValue',
            textField : 'dicText',
            panelHeight : 80,
            editable : false,
            formatter : function(row) {
                if (row.dicValue == "") {
                    return  row.dicText;
                } else {
                    return row.dicValue;
                }
            },
            onLoadSuccess : function(e) {
            }
        });

    }*/


    var select = function (obj) {
        $("#toolbarMap").children().children('a[drawingtype!="0"]').each(function () {
            console.log($(this).attr("class"));
            var str = $(this).attr("class").substring(0, $(this).attr("class").length - 6);
            if ($(this).attr("class") == 'BMapLib_box BMapLib_rectangle_hover BMapLib_last') {
                str = "BMapLib_box BMapLib_rectangle BMapLib_last";
            }
            $(this).attr("class", str);
            $(this).attr("drawingtype", "0");
        });
        if ($(obj).attr("class") == 'BMapLib_box BMapLib_rectangle_hover BMapLib_last' || $(obj).attr("class") == 'BMapLib_box BMapLib_rectangle BMapLib_last') {
            $(obj).attr("class", "BMapLib_box BMapLib_rectangle_hover BMapLib_last");
            $(obj).attr("drawingtype", '1');
        } else {
            $(obj).attr("class", $(obj).attr("class") + "_hover");
            $(obj).attr("drawingtype", '1');
        }
    }

    var searchCus = function () {
        var serverUrl = "../../jcda/ZdCus/find";
        $.ajax({
            type: "POST",
            url: serverUrl,
            async: false,
            success: function (dataObject) {
                var datas = []
                for (let index = 0; index < dataObject.rows.length; index++) {
                    const element = dataObject.rows[index];
                    var data = {
                        "id": element.CODE,
                        "text": element.SHORTNAME + "-" + element.NAME
                    }
                    datas.push(data)
                }
                $('#cusId').combobox({
                    data: datas
                });
            }
        })
    }

    /*	var close = function () {
            closeDialog("addressDetail");
        }*/
    var loadDetail = function () {
        var serverUrl = "../../jcda/ZdCus/getaddressbysn";
        $.ajax({
            type: "POST",
            url: serverUrl,
            data: { sn: sn },
            dataType: 'json',
            async: true,
            success: function (dataObj) {
                if (isServerResultDataPass(dataObj)) {
                    var data = dataObj.resultDataFull;
                    $("#address").val(data.address);
                    $("#kind").combobox('setValue', dataObj.resultDataFull.kind);
                    $("#linkman").textbox("setValue", data.linkman);
                    $("#linktel").textbox("setValue", data.linktel);
                    if (data.sf_kind != null) {
                        var att = data.sf_kind.split(",");
                        for (var i = 0; i < att.length; i++) {
                            $("[data-name='rdbsf_kind'][value='" + att[i] + "']").prop("checked", true);
                        }
                    }
                    readDistrictCityAres(data.province, data.city, data.district);
                    $("#name").textbox("setValue", data.name);

                    /*$("#addressDetail").textbox("setValue", data.address);*/
                    // $("#address").textbox("setValue", data.ex_code);
                    /*	$("#ywLocation").combobox("setValue", data.yw_location);
                        $("#ywLocation").combobox("select", data.yw_location);*/
                    $("#cusId").combobox("setValue", data.cus_id);
                    $("#cusId").combobox("select", data.cus_id);
                    $("#addressCode").textbox("setValue", data.address_code);


                    if (data.lo != null && data.la != "") {
                        var obj = { lat: data.la, lng: data.lo, O: data.lo, P: data.la };
                        map.setCenter(obj);
                        map.setZoom(15);
                        marker = new AMap.Marker({
                            position: new AMap.LngLat(data.lo, data.la), // 经纬度���象，也可以是经纬度构成的一维数组[116.39, 39.9]
                        });
                        map.add(marker);
                    } else {
                        map.setCity(data.city);
                    }
                    if (data.fence != null && data.fence != '') {
                        setWeiLan(data.fence);
                    }

                    $("#begin_arrive_trigger_event").combobox('setValue', dataObj.resultDataFull.begin_arrive_trigger_event);
                    if (dataObj.resultDataFull.begin_arrive_trigger_event === $.i18n.prop('trigger')) {
                        $("#begin_arrive_trigger_state").combobox('setValue', dataObj.resultDataFull.begin_arrive_trigger_state);
                    }
                    $("#end_arrive_trigger_event").combobox('setValue', dataObj.resultDataFull.end_arrive_trigger_event);
                    if (dataObj.resultDataFull.end_arrive_trigger_event === $.i18n.prop('trigger')) {
                        $("#end_arrive_trigger_state").combobox('setValue', dataObj.resultDataFull.end_arrive_trigger_state);
                    }

                    /*$('#cusId').combobox({readonly:true})
                    $('#cusId').combobox('disable',true)*/

                } else {
                    FailResultDataToTip(dataObj);
                }
                hideLoading();
            },
        });
    }

    var getMap = function () {
        var map = new AMap.Map("container", {//传入DIVID构造地图对象
            resizeEnable: true,//是否监控尺寸变化
            center: [116.403322, 39.900255],//地图中心点
            zoom: 15 //地图显示的缩放级别
        });
        return map;
    }

    var setWeiLan = function (obj) {
        var obj = JSON.parse(obj);
        switch (obj.drawType) {
            case "circle"://圆圈
                var data = {
                    Ch: {
                        center: {
                            lng: null,
                            lat: null
                        },
                        radius: null
                    }
                };
                data.Ch.center.lng = obj.coordDatas.lng;
                data.Ch.center.lat = obj.coordDatas.lat;
                data.Ch.radius = obj.coordDatas.radius;
                editor._circle(data);
                break;
            /* case "polyline":
                var data = {
                    Ch:{
                        path:null
                    }
                };
                data.Ch.path = obj.coordDatas;
                editor._line(data);
              break; */
            case "polygon":
                var data = {
                    Ch: {
                        path: null
                    }
                };
                data.Ch.path = obj.coordDatas;
                editor._polygon(data);
                break;
            default:
                errorNotification({
                    SimpleMessage: "#{Unidentified electronic fence}!"
                });
                return;
        }
    }



    $.extend($.fn.validatebox.defaults.rules, {
        phoneNum: { //验证手机号
            validator: function (value, param) {
                return /^1[3-8]+\d{9}$/.test(value);
            },
            message: '#{addressDetail_validTel}。'
        },

        telNum: { //既验证手机号，又验证座机号
            validator: function (value, param) {
                return /(^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$)|(^(()|(\d{3}\-))?(1[345678]\d{9})$)/.test(value);
            },
            message: $.i18n.prop('tel is incorrect format')
        },

        /*		addressCode:{
                    validator: function (value) {
                        $.ajax({
                            async : true,
                            cache : false,
                            type : 'post',
                            url : '../../jcda/ZdCus/checkReq?t=' + Math.random() + '&code='+value + '&sn=' + sn,
                            success: function (re){
                                result = re
                            }

                        });
                    return result.resultCode === "3"
                    },
                    message: $.i18n.prop('address code is repetition')
                }*/
    });

    var validate = function () {
        var validated = $("#addForm").form('enableValidation').form('validate');
        if (!validated) {
            return false;
        }
        var linkman = $("#linkman").textbox("getValue");
        if (linkman == '') {
            return false;
        }

        var linkTel = $("#linktel").textbox("getValue");
        if (linkTel == '') {
            return false;
        }

        // var address = $("#address").textbox("getValue");
        // if(address == '') {
        // 	return false;
        // }

        /*var ywLocation = $("#ywLocation").combobox("getValue");
        if(ywLocation == '') {
            return false;
        }
*/
        var customer = $("#cusId").combobox("getValue");
        if (customer == '') {
            return false;
        }
        return true;
    }

    var save = function () {

        if (!validate()) {
            return;
        }

        var dataForm = FormUtils.toJSONObject($("#addForm"));
        dataForm.kind = $("#kind").combobox("getValue");
        if (dataForm.kind == "--#{addressDetail_all}--") {
            dataForm.kind = "";
        }


        if (dataForm.rdbsf_kind_1 == undefined && dataForm.rdbsf_kind_2 == undefined && dataForm.rdbsf_kind_3 == undefined) {
            errorNotification({
                SimpleMessage: "#{addressDetail_cannotBeEmpty}！",
            });
            return false;
        }
        if (dataForm.address == address && dataForm.lo == lo && dataForm.la == la) {
            vo = FormUtils.toJSONObject($("#addForm"));
        } else if (dataForm.address != address && dataForm.lo == lo && dataForm.la == la) {
            errorNotification({
                SimpleMessage: $.i18n.prop('addressDetail_addressError'),
            });
            return false;
        }

        if (dataForm.begin_arrive_trigger_event === $.i18n.prop('null') || !dataForm.begin_arrive_trigger_event) {
            dataForm.begin_arrive_trigger_state = '';
        }

        if (dataForm.end_arrive_trigger_event === $.i18n.prop('null') || !dataForm.end_arrive_trigger_event) {
            dataForm.end_arrive_trigger_state = '';
        }
        console.log(dataForm);
        $.messager.confirm('#{addressDetail_tip} ', '#{addressDetail_save}?', function (r) {
            if (r) {
                showLoading();
                afterSave = "close";
                $.ajax({
                    url: '../../jcda/ZdCus/savelocation?t=' + Math.random(),
                    type: 'POST',
                    data: 'jsonData=' + JSON.stringify(dataForm),
                    success: function (dataObj) {
                        if (isServerResultDataPass(dataObj)) {
                            hideLoading();
                            correctNotification({ SimpleMessage: $.i18n.prop('addressDetail_saveSuccess') });
                            afterSaveOperate();
                        } else {
                            hideLoading();
                            FailResultDataToTip(dataObj);
                        }

                    }
                });
            }
        });
    }

    var afterSaveOperate = function () {
        switch (afterSave) {
            case "edit":
                /* code = $("#code").textbox("getValue"); */
                refreshCallerData();
                close();
                break;
            case "close":
                refreshCallerData();
                close();
                break;
            case "clear":
                $('form').form('clear');
                $("#sn").val("0");
                //                $("input", $("#txtCode").next("span")).removeAttr("readonly");
                refreshCallerData();
                break;
            case "copy":
                $("#sn").val("0");
                //                $("input", $("#txtCode").next("span")).removeAttr("readonly");
                $("#credentials").textbox('setValue', '');
                refreshCallerData();
                break;
        }
    }

    var refreshCallerData = function () {
        if (callerType == Global_Constant.Global_Constant_CallerType_Dialog) {
            //此callerId此时为dialog的id
            getDialog(callerId).refreshCallerData_zdLocationType(callbackFlag);
        } else {
            //此callerId此时为frame的id
            getCurrentTab(callerId).refreshCallerData_zdLocationType(callbackFlag);
        }
    }





    var readProvince = function () {

        $("#beginDistrict").combobox({
            valueField: "name",
            textField: "name",
            data: [],
            onSelect: function (row) {
                $("#beginCity").combobox("setValue", "");
                $("#beginArea").combobox("setValue", "");
                readCity($("#beginCity"), row.name);
            }
        });

        $("#beginCity").combobox({
            valueField: "name",
            textField: "name",
            data: [],
            onSelect: function (row) {
                $("#beginArea").combobox("setValue", "");
                readArea($("#beginArea"), row.name);
            }
        });

        $("#beginArea").combobox({
            valueField: "name",
            textField: "name",
            data: []
        });

        var opts = {
            subdistrict: 1,
            showbiz: false
        };
        var district = new AMap.DistrictSearch(opts);
        district.search("", function (status, result) {
            if (result.info != undefined) {
                var list = result.districtList[0].districtList;
                $("#beginDistrict").combobox("loadData", list);
            }
        })
    }


    var readArea = function (toObj, city) {
        var opts = {
            subdistrict: 3,
            showbiz: false
        };

        var district = new AMap.DistrictSearch(opts);
        district.search(city, function (status, result) {
            if (result.info != undefined) {
                var list = result.districtList[0].districtList;
                toObj.combobox("loadData", list);
            }
        })
    }

    var readCity = function (toObj, province) {
        var opts = {
            subdistrict: 2,
            showbiz: false
        };

        var district = new AMap.DistrictSearch(opts);
        district.search(province, function (status, result) {
            if (result.info != undefined) {
                var list = result.districtList[0].districtList;
                toObj.combobox("loadData", list);
            }
        })
    }

    /**-------------------------------------------高德地图开始-------------------------------------------**/
    //初始化地址下拉框
    /*var tipinput = function(tipinput, remark) {
                AMap.plugin(['AMap.Autocomplete', 'AMap.PlaceSearch'], function(){
                    var autoOptions = {
                        input: tipinput
                    };
                    var autocomplete = new AMap.Autocomplete(autoOptions);

                    AMap.event.addListener(autocomplete, "select", function(e) {
                        var placeSearch = new AMap.PlaceSearch({
                            city: e.poi.adcode,
                            children: 1
                        });

                        placeSearch.getDetails(e.poi.id, function(status, result) {
                            var poi = result.poiList.pois[0];
                            var district = poi.pname;
                            var city = poi.cityname;
                            var area = poi.adname;


                            remark.textbox("setValue", poi.name);
                            readDistrictCityAres(district, city, area);
                            $("#lo").textbox('setValue',poi.entr_location.O);
                            $("#la").textbox('setValue',poi.entr_location.M);
                            if(poi.entr_location.O==null|| poi.entr_location.M==''){
                                errorNotification({
                                    SimpleMessage: "解析经纬度失败!"
                                });
                                map.setCenter([116.403322, 39.900255]);//地图中心点
                                map.setZoom(13)
                                /!* 	map.setCity(data.poi.adcode);
                                    map.setZoom(3); *!/
                            }else{
                                map.setCenter(poi.entr_location);
                                map.setZoom(15)
                                $("#lo").val(poi.entr_location.O)
                                $("#la").val(poi.entr_location.M)
                                marker = new AMap.Marker({
                                    position: new AMap.LngLat(poi.entr_location.O,poi.entr_location.M),   // 经纬度对象，也可以是经纬度构成的一维数组[116.39, 39.9]
                                });
                                map.add(marker);
                            }

                        });
                    });
                });
            }

    var map = new AMap.Map('container', {
        resizeEnable : true,
        zoom : 12,
        center : [ 118.756376, 32.052573 ]
    });

    var infowindow;
    map.plugin('AMap.AdvancedInfoWindow', function() {
        infowindow = new AMap.AdvancedInfoWindow({
            panel : 'panel',
            placeSearch : true,
            asOrigin : true,
            asDestination : true
        });
    });





    */
    var readDistrictCityAres = function (district, city, area) {
        $("#beginDistrict").combobox("setValue", district);
        $("#beginDistrict").combobox("options").onSelect({
            name: district
        });

        $("#beginCity").combobox("setValue", city);
        $("#beginCity").combobox("options").onSelect({
            name: city
        });
        $("#beginArea").combobox("setValue", area);
    }
    //
</script>
<link rel="stylesheet" href="https://cache.amap.com/lbs/static/main1119.css" />
<link rel="stylesheet" href="https://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.css" />
<link href="../../Resource/css/main.css" type="text/css" rel="stylesheet" />

<script type="text/javascript" src="https://cache.amap.com/lbs/static/addToolbar.js"></script>
<script src="https://cache.amap.com/lbs/static/es5.min.js"></script>
<script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
<script
    src="https://webapi.amap.com/maps?v=1.4.5&key=7defcebd378d7fcd05dbcb9298d20d2e&plugin=AMap.PolyEditor,AMap.Geocoder,AMap.CircleEditor,AMap.RectangleEditor,AMap.MouseTool,AMap.ToolBar,AMap.DistrictSearch"></script>
<!--
<script src="https://webapi.amap.com/maps?v=1.3&key=7defcebd378d7fcd05dbcb9298d20d2e&plugin=AMap.ToolBar,AMap.DistrictSearch"></script>AMap.MouseTool,AMap.ToolBar,AMap.DistrictSearch

-->

<script language="javascript" type="text/javascript">
    map = new AMap.Map("container", { //传入DIVID构造地图对象
        resizeEnable: false,//是否监控尺寸变化
        center: [116.403322, 39.900255],//地图中心点
        zoom: 13 //地图显示的缩放级别
    });
    ['en', 'zh_en', 'zh_cn'].forEach(function (btn) {
        var button = document.getElementById(btn);
        AMap.event.addDomListener(button, 'click', clickListener)
    });

    function clickListener() {
        map.setLang(this.id);
    }
    AMap.plugin(['AMap.Scale'], function () {
        map.addControl(new AMap.Scale());
    })
    //在地图中添加MouseTool插件
    var mouseTool = new AMap.MouseTool(map);
    /*    AMap.event.addDomListener(document.getElementById('marker'), 'click', function() {
           mouseTool.marker({offset:new AMap.Pixel(-14,-11)});
       }, false); */
    /*    AMap.event.addDomListener(document.getElementById('polyline'), 'click', function() {
           mouseTool.polyline();
       }, false); */
    AMap.event.addDomListener(document.getElementById('polygon'), 'click', function () {
        mouseTool.polygon();
    }, false);
    AMap.event.addDomListener(document.getElementById('rectangle'), 'click', function () {

        mouseTool.rectangle();
    }, false);
    AMap.event.addDomListener(document.getElementById('initbtn'), 'click', function () {
        if (!(marker == undefined)) {
            map.setCenter(marker.Ch.position);
            map.setZoom(15);
        }
        mouseTool.close(false);
    }, false);
    AMap.event.addDomListener(document.getElementById('circle'), 'click', function () {
        mouseTool.circle();
    }, false);
    AMap.event.addListener(mouseTool, "draw", function callback(e) {
        //objArrayJson
        //mouseTool.close(true);
        var obj = e.obj;//obj属性就是鼠标事件完成所绘制的覆盖物对象。
        //console.log(obj);
        if (obj.CLASS_NAME == "AMap.Circle") {//圆   圆心经纬度 半径
            editor._circle(obj);
            mouseTool.circle();
        }/* else if(obj.CLASS_NAME == "AMap.Polyline"){//线   N组经纬度按顺序排列
        	mouseTool.polyline();
        	editor._line(obj);
        }else if(obj.CLASS_NAME == "AMap.Marker"){//点
        	mouseTool.({offset:new AMap.Pixel(-14,-11)});
        } */else if (obj.CLASS_NAME == "AMap.Polygon") {//多边形  N组经纬度按顺序排列   目前暂未识别矩形和多边形
            mouseTool.polygon();
            editor._polygon(obj);
        } else if (obj.CLASS_NAME == "AMap.rectangle") {//矩形   四组经纬度
            mouseTool.rectangle();
        } else {
            errorNotification({
                SimpleMessage: "#{addressDetail_drawingTips}...."
            });
            return;
        }
        console.log($("#fence").val());
    });
    AMap.plugin(['AMap.Autocomplete', 'AMap.PlaceSearch'], function () {//回调函数
        var autoOptions = {
            city: "", //城市，默认全国
            input: "address"//使用联想输入的input的id */
        };
        var autocomplete = new AMap.Autocomplete(autoOptions);
        AMap.event.addListener(autocomplete, "select", function (e) {
            var placeSearch = new AMap.PlaceSearch({
                city: e.poi.adcode,
                children: 1
            });

            placeSearch.getDetails(e.poi.id, function (status, result) {
                var poi = result.poiList.pois[0];
                var district = poi.pname;
                var city = poi.cityname;
                var area = poi.adname;
                var address = poi.address;
                console.log(poi);
                readDistrictCityAres(district, city, area);
                $("#address").val(address);

                $("#lo").textbox('setValue', poi.location.lng);
                $("#la").textbox('setValue', poi.location.lat);
                if (poi.location.lng == null || poi.location.lat == '') {
                    errorNotification({
                        SimpleMessage: "解析经纬度失败!"
                    });
                    map.setCenter([116.403322, 39.900255]);//地图中心点
                    map.setZoom(13)
                    /*/!* 	map.setCity(data.poi.adcode);
                    map.setZoom(3); *!/*/
                } else {
                    map.setCenter(poi.location);
                    map.setZoom(15)
                    $("#lo").val(poi.location.lng)
                    $("#la").val(poi.location.lat)
                    marker = new AMap.Marker({
                        position: new AMap.LngLat(poi.location.lng, poi.location.lat),   // 经纬度对象，也可以是经纬���构成的一维数组[116.39, 39.9]
                    });
                    map.add(marker);
                }
            });
        });
    })



    //在地图上绘制折线
    //var editor={};
    /*  editor._line=(function(obj){
         var list = obj.Ch.path;
          var lineArr = new Array();
          for(var i=0;i<list.length;i++){
              lineArr[i] = new Array();
              lineArr[i][0] = list[i].lng;
              lineArr[i][1] = list[i].lat;
          }
          map.clearMap();
          if(!(marker==undefined)){
              map.add(marker); //定位点
          }
          var Polyline =  new AMap.Polyline({
              map: map,
              path: lineArr,
              strokeColor: "#FF33FF",//线颜色
              strokeOpacity: 1,//线透明度
              strokeWeight: 3,//线宽
              strokeStyle: "solid"//线样式
          });
          editor._lineEditor= new AMap.PolyEditor(map,Polyline);
          editor._lineEditor.open();
          AMap.event.addListener(editor._lineEditor, "addnode", function callback(e) {
              //通过鼠标在折线上增加一个节点或在多边形上增加一个顶点时触发此事件
              console.log("addnode");
              var model = JSON.parse($("#fence").val());
              model.drawType = "polyline";
              model.coordDatas = e.target.Ch.path;
              $("#fence").val(JSON.stringify(model));
          });
          AMap.event.addListener(editor._lineEditor, "adjust", function callback(e) {
              //鼠标调整折线上某个节点或多边形上某个顶点的位置时触发此事件
              console.log("addnode");
              var model = JSON.parse($("#fence").val());
              model.drawType = "polyline";
              model.coordDatas = e.target.Ch.path;
              $("#fence").val(JSON.stringify(model));
          });
          var  warningFence = {};
          warningFence.drawType = "polyline";
          warningFence.coordDatas = lineArr;
          $("#fence").val(JSON.stringify(warningFence));

          return Polyline;

      }); */



    function Sjtb() {
        if ($("#fence").val() != "") {
            map.clearMap();
            console.log($("#fence").val());
            if (!(marker == undefined)) {
                map.add(marker); //定位点
            }
            $("#fence").val("");
        }
    }

    editor._polygon = (function (obj) {
        var list = obj.Ch.path;
        var arr = new Array();
        for (var i = 0; i < list.length; i++) {
            arr[i] = new Array();
            arr[i][0] = list[i].lng;
            arr[i][1] = list[i].lat;
        }
        map.clearMap();
        if (!(marker == undefined)) {
            map.add(marker); //定位点
        }
        var polygon = new AMap.Polygon({
            map: map,
            path: arr,
            strokeColor: "#0000ff",
            strokeOpacity: 1,
            strokeWeight: 3,
            fillColor: "#f5deb3",
            fillOpacity: 0.35
        });
        editor._polygonEditor = new AMap.PolyEditor(map, polygon);
        editor._polygonEditor.open();

        AMap.event.addListener(editor._polygonEditor, "addnode", function callback(e) {
            //通过鼠标在折线上增加一个节点或在多边形上增加一个顶点时触发此事件
            console.log("addnode");
            var model = JSON.parse($("#fence").val());
            model.drawType = "polygon";
            model.coordDatas = e.target.Ch.path;
            $("#fence").val(JSON.stringify(model));
        });
        AMap.event.addListener(editor._polygonEditor, "adjust", function callback(e) {
            //鼠标调整折线上某个节点或多边形上某个顶点的位置时触发此事件
            console.log("addnode");
            var model = JSON.parse($("#fence").val());
            model.drawType = "polygon";
            model.coordDatas = e.target.Ch.path;
            $("#fence").val(JSON.stringify(model));
        });

        var warningFence = {};
        warningFence.drawType = "polygon";
        warningFence.coordDatas = arr;
        $("#fence").val(JSON.stringify(warningFence));
        return polygon;

    });
    editor._circle = (function (obj) {
        var circle = new AMap.Circle({
            center: [obj.Ch.center.lng, obj.Ch.center.lat],// 圆心位置
            radius: obj.Ch.radius, //半径
            strokeColor: "#F33", //线颜色
            strokeOpacity: 1, //线透明度
            strokeWeight: 3, //线粗细度
            fillColor: "#ee2200", //填充颜色
            fillOpacity: 0.35//填充透明度
        });
        map.clearMap();
        if (!(marker == undefined)) {
            map.add(marker); //定位点
        }

        circle.setMap(map);
        editor._circleEditor = new AMap.CircleEditor(map, circle);
        editor._circleEditor.open();

        AMap.event.addListener(editor._circleEditor, "move", function callback(e) {
            //经纬度
            var model = JSON.parse($("#fence").val());
            model.coordDatas.lng = e.lnglat.lng;
            model.coordDatas.lat = e.lnglat.lat;
            model.drawType = "circle";
            $("#fence").val(JSON.stringify(model));
        });
        //圆心
        AMap.event.addListener(editor._circleEditor, "adjust", function callback(e) {
            console.log(e);
            var model = JSON.parse($("#fence").val());
            model.coordDatas.radius = e.radius;
            model.drawType = "circle";
            $("#fence").val(JSON.stringify(model));
        });
        var warningFence = {};
        warningFence.drawType = "circle";
        warningFence.coordDatas = { radius: obj.Ch.radius, lng: obj.Ch.center.lng, lat: obj.Ch.center.lat };
        $("#fence").val(JSON.stringify(warningFence));
        return circle;
    });
    map.setFitView();

    function getcallback(poi) {
        var str = poi.cityname + poi.adname + poi.address;
        $("#address").val(str);
        $("#city").textbox('setValue', poi.cityname);
        $("#province").textbox('setValue', poi.pname);
        $("#lo").textbox('setValue', poi.location.lng);
        $("#la").textbox('setValue', poi.location.lat);
        if (poi.location == null || poi.location == '') {
            map.setCity(poi.cityname);
            map.setZoom(3);
        } else {
            map.setCenter(poi.location);
            map.setZoom(15)
            $("#lo").val(poi.location.lng)
            $("#la").val(poi.location.lat)
        }
        var marker = new AMap.Marker({
            position: new AMap.LngLat(poi.location.lng, poi.location.lat),   // 经纬度对象，也可以是经纬度构成的一维数组[116.39, 39.9]
        });
        map.add(marker);
    }





    /**-------------------------------------------高德地图结束-------------------------------------------**/
</script>

</html>